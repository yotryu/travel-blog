import"../chunks/DsnmJJEf.js";import{o as mt}from"../chunks/FsTs4vV3.js";import{ak as Z,o as qe,p as Fe,a8 as ht,aw as yt,z as Re,W as bt,Y as xt,$ as wt,Z as kt,r as Le,G as St,q as It,A as ve,aa as Pt,a7 as Dt,af as T,au as Tt,ab as ye,ac as K,ad as b,a9 as Ct,ae as _,al as t,ag as S,am as J,ai as h,aj as f,ah as p,an as V,ax as Et}from"../chunks/BLq7Ua4-.js";import{s as Be}from"../chunks/CPa6ouks.js";import{i as R}from"../chunks/CjYXtWFW.js";import{e as Ue,i as Ke,s as Je,t as be,a as xe}from"../chunks/BsQbfKRW.js";import{b as At,a as Nt,s as Ge}from"../chunks/CDOJrobL.js";import{b as ze}from"../chunks/Ujk8DKch.js";import{I as Ot}from"../chunks/o2icwVxu.js";function $t(u,s,x=!1,I=!1,ie=!1){var $=u,M="";Z(()=>{var L=ht;if(M===(M=s()??"")){qe&&Fe();return}if(L.nodes_start!==null&&(yt(L.nodes_start,L.nodes_end),L.nodes_start=L.nodes_end=null),M!==""){if(qe){Re.data;for(var C=Fe(),se=C;C!==null&&(C.nodeType!==bt||C.data!=="");)se=C,C=xt(C);if(C===null)throw wt(),kt;Le(Re,se),$=St(C);return}var O=M+"";x?O=`<svg>${O}</svg>`:I&&(O=`<math>${O}</math>`);var j=It(O);if((x||I)&&(j=ve(j)),Le(ve(j),j.lastChild),x||I)for(;ve(j);)$.before(ve(j));else $.before(j)}})}const jt=async({fetch:u})=>({collections:await(await u("/collections/all.json")).json()}),ka=Object.freeze(Object.defineProperty({__proto__:null,load:jt},Symbol.toStringTag,{value:"Module"}));function He(u){return new Promise((s,x)=>{const I=document.createElement("script");I.src=u,document.body.appendChild(I),I.addEventListener("load",()=>s(I)),I.addEventListener("error",()=>x(I))})}var qt=(u,s,x)=>!u.inputType||u.inputType=="insertReplacementText"?s(x(u),!0):{},Ft=S("<option></option>"),Rt=S('<span class="post-id svelte-5xvg81">-- Getting post ID --</span>'),Lt=S('<span class="post-id svelte-5xvg81"> </span>'),Bt=(u,s)=>_(s,!0),Ut=(u,s)=>s(),Kt=(u,s)=>s(),Jt=S('<div class="overlay svelte-5xvg81"><div class="overlay svelte-5xvg81"></div> <div><textarea class="content-input svelte-5xvg81" id="contentTextArea" placeholder="Add post content..."></textarea> <div class="content-bottom svelte-5xvg81"><button class="add-button svelte-5xvg81">Upload All</button></div></div></div>'),Gt=(u,s)=>_(s,!0),zt=S("<div> </div>"),Ht=(u,s)=>s("chooseImages"),Mt=(u,s)=>s(u),Wt=(u,s,x)=>s(t(x),-1),Yt=(u,s,x)=>s(t(x),1),Vt=(u,s,x)=>s(t(x)),Zt=S('<div class="image-preview-container svelte-5xvg81"><img class="image-preview svelte-5xvg81"/> <div class="overlay svelte-5xvg81"><div class="right-align svelte-5xvg81"><div class="svelte-5xvg81"><button class="image-preview-button svelte-5xvg81">↑</button></div> <div class="bottom-right svelte-5xvg81"><button class="image-preview-button svelte-5xvg81">↓</button></div></div> <div class="left-align svelte-5xvg81"><button class="image-preview-button red-button svelte-5xvg81">-</button></div></div></div> <div class="small-margins svelte-5xvg81"></div>',1),Qt=S('<div class="overlay svelte-5xvg81"></div> <div class="image-edit-popout svelte-5xvg81"><div class="small-margins svelte-5xvg81"><button class="add-button fill-width svelte-5xvg81">Add Images...</button> <input id="chooseImages" type="file" accept="image/*" multiple style="display:none;"/></div> <div class="small-margins bottom-line svelte-5xvg81"></div> <div class="small-margins svelte-5xvg81"></div></div>',1),Xt=S("<p>Cancelling...</p>"),ea=(u,s)=>_(s,!0),ta=S('<button class="add-button red-button svelte-5xvg81">Cancel</button>'),aa=(u,s,x)=>{_(s,!1),_(x,"")},la=S('<button class="add-button svelte-5xvg81">Done</button>'),na=S('<div class="overlay-darken center-parent svelte-5xvg81"><div class="center-login svelte-5xvg81"><h3>Uploading...</h3> <!> <div class="small-padding svelte-5xvg81"><!></div></div></div>'),ia=S('<!> <div class="header svelte-5xvg81"><input class="collection-input svelte-5xvg81" id="inputCollection" list="collectionList" placeholder="Collection"/> <datalist id="collectionList"></datalist> <!> <div class="svelte-5xvg81"><input class="title-input svelte-5xvg81" id="inputTitle" placeholder="Title" size="35"/></div> <div class="svelte-5xvg81"><input class="small-input svelte-5xvg81" id="inputDate" placeholder="Date"/></div> <div class="svelte-5xvg81"><button class="add-button svelte-5xvg81">Edit Images...</button></div> <div class="small-vertical-padding svelte-5xvg81"><button class="add-button red-button svelte-5xvg81">Clear Post Data</button></div></div> <!> <!> <!>',1),sa=(u,s)=>s("chooseAuthKeyFile"),oa=(u,s)=>s(u),ra=S('<button class="add-button svelte-5xvg81">Load API Key</button> <input id="chooseAuthKeyFile" type="file" accept=".txt" multiple style="display:none;"/>',1),ca=(u,s)=>s(),va=(u,s)=>s(),da=S('<h1 class="title svelte-5xvg81">Login</h1> <div class="small-padding svelte-5xvg81"><button class="add-button svelte-5xvg81">Authenticate</button></div> <div class="small-padding svelte-5xvg81"><button class="add-button red-button svelte-5xvg81">Remove API Key</button></div>',1),ua=S('<h1 class="title svelte-5xvg81">Loading...</h1>'),ga=S('<div class="overlay-darken center-parent svelte-5xvg81"><div class="center-login svelte-5xvg81"><!></div></div>');function Sa(u,s){Dt(s,!0);const x={duration:200,x:-100,opacity:0};let I=T(0),ie=T(0),$=J(()=>t(I)<=t(ie)),M=J(()=>t(I)/t(ie)>=2),L=J(()=>t($)?{duration:200,y:100,opactiy:0}:{duration:200,x:100,opacity:0}),C=J(()=>t($)?"content-container-portrait":"content-container"),se=J(()=>t($)?"edge-container-portrait":"edge-container"),O=T(!1),j=J(()=>t(O)?t($)?"expanded-portrait":t(M)?"expanded-ultrawide":"expanded":""),Me=J(()=>t($)?"↑":"←"),de=T(!1),ue,W=T(""),we=T(!1),ke=T(!1),Q=T(!1),Y=T(!1),P=T(""),We=T(!1),ge=T(!1),Se={id:"",collection:"",date:"",title:"",content:"",contentParagraphs:[],images:[]},d=T(Tt(Se));function Ye(e){let a=e.target;if(!(!a||!a.files))for(let l=0;l<a.files.length;++l){let n=a.files[l];const i=new FileReader;i.onload=function(){if(i.result){const o={data:i.result.toString(),name:n.name},r={name:n.name,data:{src:o.data,collageSrc:"",navSrc:""}};t(d).images.push(r),lt(r)}},i.readAsDataURL(n)}}function Ve(e){t(d).images=t(d).images.filter(a=>a!=e)}function Ie(e,a){let l=t(d).images.findIndex(i=>i==e);if(l<0)return;let n=l+a;n>=t(d).images.length||t(d).images.splice(n,0,t(d).images.splice(l,1)[0])}function Pe(e){let a=document.getElementById(e);a&&a.click()}function X(e){let a=e.target;return a?a.value:""}function Ze(e){t(d).content=e,t(d).contentParagraphs=e.split(`
`)}function Qe(){_(d,Se,!0);let e=document.getElementById("inputTitle");e.value="";let a=document.getElementById("inputDate");a.value="";let l=document.getElementById("inputCollection");l.value="";let n=document.getElementById("contentTextArea");n.value=""}async function pe(e){const l=await(await fetch(e).then(n=>n.blob())).arrayBuffer();return new Uint8Array(l)}async function De(e,a){let l=document.createElement("canvas"),n=l.getContext("2d");if(!n)return null;const i=a/(e.width/e.height);let o=Math.min(a/e.width,i/e.height),r=e.width*o,c=e.height*o;return l.width=r,l.height=c,n.drawImage(e,0,0,r,c),l.toDataURL("image/jpeg")}function Te(e,a){t(d).collection=e,a&&et()}async function ee(e){try{return await gapi.client.request(e)}catch(a){a.status&&(a.status==404||a.status==401)&&_e()}return null}async function te(e,a=!1){let l=e.split("/"),n="root";for(let i=0;i<l.length;++i){let o=l[i],r=`'${n}' in parents and name = '${o}' and mimeType = 'application/vnd.google-apps.folder' and trashed = false`,c=await ee({path:`/drive/v3/files?q=${encodeURI(r)}`,method:"GET"});if(!c)return null;let m=JSON.parse(c.body);if(!m.files||m.files.length==0){if(a){let E=JSON.stringify({name:o,parents:[n],mimeType:"application/vnd.google-apps.folder"});if(!await ee({path:"/drive/v3/files",method:"POST",body:E,headers:{"content-type":"application/json","content-length":E.length}}))return null;--i;continue}return null}n=m.files[0].id}return n}async function Xe(){let e=`BlogData/Posts/${t(d).collection}`,a=`${t(d).collection}-01`,l=await te(e);if(!l)return a;let n=`'${l}' in parents and mimeType != 'application/vnd.google-apps.folder'`,i=await ee({path:"/drive/v3/files",params:{q:n},method:"GET"});if(!i)return a;let o=JSON.parse(i.body);if(!o.files||o.files.length==0)return a;o.files.sort((y,q)=>y.name<q.name?-1:y.name>q.name?1:0);let c=o.files[o.files.length-1].name.split("."),w=c[c.length-2].match(/(?:\d+)(?!.*\d)/),E=w?w[0]:null;return E?`${t(d).collection}-${String(Number(E)+1).padStart(2,"0")}`:a}async function Ce(e){let a=e.split("/"),l=a.slice(0,-1).join("/"),n=a[a.length-1],i=await te(l);if(!i)return null;let o=`'${i}' in parents and name = '${n}'`,r=await ee({path:"/drive/v3/files",params:{q:o},method:"GET"});if(!r)return null;let c=JSON.parse(r.body);return!c.files||c.files.length==0?null:c.files[0].id}async function et(){_(ge,!0);let e=await Xe();t(d).id=e,_(ge,!1)}async function tt(){_(Y,!1),_(Q,!0),_(P,"");let e=!0,a=JSON.parse(JSON.stringify(t(d)));a.images=new Array(t(d).images.length),a.contentParagraphs=void 0;let l=`BlogData/Photos/${a.collection}`,n=await te(l);for(let o=0;o<t(d).images.length&&!t(Y);++o){let r=t(d).images[o];_(P,t(P)+`Uploading images for '${r.name}'... `);let c=await at(r,n);if(e=!!c,_(P,t(P)+((e?"Success":"Failed")+"<br>")),!e||!c)break;a.images[o]=c}l=`BlogData/Posts/${a.collection}`;let i=`${l}/${a.id}.json`;if(e&&!t(Y)){let o=JSON.stringify(a),r=new TextEncoder;_(P,t(P)+`Uploading '${i}'... `);let c=await oe(i,null,r.encode(o));_(P,t(P)+(c?"Success":"Failed"))}t(Y)&&_(P,t(P)+"Cancelled"),_(Q,!1)}async function at(e,a){let l={src:"",collageSrc:"",navSrc:""},n=e.name.split("."),i=n[0],o=`BlogData/Photos/${t(d).collection}`;a||(a=await te(o,!0));let r=await pe(e.data.src),c=`${o}/${e.name}`,m=await oe(c,a,r);if(m)l.src=`https://lh3.googleusercontent.com/d/${m}?authuser=0`;else return null;let w=i+"_w1000."+n[1];if(c=`BlogData/Photos/${t(d).collection}/${w}`,r=await pe(e.data.collageSrc),m=await oe(c,a,r),m)l.collageSrc=`https://lh3.googleusercontent.com/d/${m}?authuser=0`;else return null;if(w=i+"_w200."+n[1],c=`BlogData/Photos/${t(d).collection}/${w}`,r=await pe(e.data.navSrc),m=await oe(c,a,r),m)l.navSrc=`https://lh3.googleusercontent.com/d/${m}?authuser=0`;else return null;return l}async function lt(e){const a={collageSrc:1e3,navSrc:200};let l=new Image,n=new Promise((r,c)=>{l.onload=()=>{r(l)},l.onerror=()=>{c()}});l.src=e.data.src,await n;let i=await De(l,a.collageSrc),o=t(d).images.find(r=>r.name==e.name);i&&o&&(o.data.collageSrc=i),i=await De(l,a.navSrc),i&&o&&(o.data.navSrc=i)}async function oe(e,a,l){let n=await Ce(e);if(n)return n;let i=e.split("/"),o=i[i.length-1];if(!a){let y=i.slice(0,-1).join("/");a=await te(y,!0)}let c=JSON.stringify({name:o,parents:[a]}),m=await ee({path:"/upload/drive/v3/files?uploadType=resumable",method:"POST",body:c,headers:{"content-type":"application/json","content-length":c.length,"x-upload-content-length":l.byteLength}});if(!m||!m.headers)return null;let E=JSON.parse(JSON.stringify(m.headers)).location;try{let y=await fetch(E,{method:"PUT",body:l,headers:{"content-length":l.byteLength.toString()}});if(!y||!y.ok)return _e(),null}catch{}return n=await Ce(e),n}async function Ee(){await gapi.client.init({apiKey:t(W)}),ue=google.accounts.oauth2.initTokenClient({client_id:"953825518423-opf6ljfsqvslodfru7ugocm5ps5rgacp.apps.googleusercontent.com",scope:"https://www.googleapis.com/auth/drive.file",callback:async e=>{if(e.error!==void 0)throw alert(`Failed to authenticate: ${e}`),e;_(ke,!0)}}),_(we,!0)}function nt(e){let a=e.target;if(!a||!a.files||a.files.length==0)return;let l=a.files[0];const n=new FileReader;n.onload=function(){n.result&&(_(W,n.result.toString(),!0),localStorage.setItem("apiKey",t(W)),gapi.load("client",Ee))},n.readAsText(l)}function it(){localStorage.removeItem("apiKey"),_(W,"")}function _e(){gapi.client.getToken()===null?ue.requestAccessToken({prompt:"consent"}):ue.requestAccessToken({prompt:""})}mt(async()=>{await He("https://apis.google.com/js/api.js"),await He("https://accounts.google.com/gsi/client");let e=localStorage.getItem("apiKey");e&&(_(W,e,!0),gapi.load("client",Ee))});var Ae=ye(),st=K(Ae);{var ot=e=>{var a=ia(),l=K(a);{let v=J(()=>t(d).images.map(g=>g.data));Ot(l,{get imagesData(){return t(v)}})}var n=h(l,2),i=f(n);i.__input=[qt,Te,X];var o=h(i,2);Ue(o,21,()=>s.data.collections,Ke,(v,g)=>{var k=Ft(),D={};Z(()=>{D!==(D=t(g).id)&&(k.value=(k.__value=t(g).id)??"")}),b(v,k)}),p(o);var r=h(o,2);{var c=v=>{var g=Rt();b(v,g)},m=v=>{var g=Lt(),k=f(g,!0);p(g),Z(()=>Be(k,t(d).id)),b(v,g)};R(r,v=>{t(ge)?v(c):v(m,!1)})}var w=h(r,2),E=f(w);p(w);var y=h(w,2),q=f(y);p(y);var G=h(y,2),fe=f(G);fe.__click=[Bt,de],p(G);var ae=h(G,2),me=f(ae);me.__click=[Ut,Qe],p(ae),p(n);var Ne=h(n,2);{var ct=v=>{var g=Jt(),k=f(g),D=h(k,2),A=f(D);At(A);var z=h(A,2),le=f(z);le.__click=[Kt,tt],p(z),p(D),p(g),Z(()=>{Je(D,1,`${t(C)??""} ${t(j)??""}`,"svelte-5xvg81"),Nt(A,t(d).content)}),V("click",k,()=>_(O,!1),!0),V("change",A,H=>{_(We,H.target==document.activeElement),Ze(X(H))},!0),be(3,D,()=>xe,()=>t(L)),b(v,g)},vt=v=>{var g=zt();g.__click=[Gt,O];var k=f(g,!0);p(g),Z(()=>{Je(g,1,t(se),"svelte-5xvg81"),Be(k,t(Me))}),be(3,g,()=>xe,()=>t(L)),b(v,g)};R(Ne,v=>{t(O)?v(ct):v(vt,!1)})}var Oe=h(Ne,2);{var dt=v=>{var g=Qt(),k=K(g),D=h(k,2),A=f(D),z=f(A);z.__click=[Ht,Pe];var le=h(z,2);le.__change=[Mt,Ye],p(A);var H=h(A,4);Ue(H,21,()=>t(d).images,Ke,(B,N)=>{var re=Zt(),ce=K(re),ne=f(ce),F=h(ne,2),U=f(F),he=f(U),pt=f(he);pt.__click=[Wt,Ie,N],p(he);var $e=h(he,2),_t=f($e);_t.__click=[Yt,Ie,N],p($e),p(U);var je=h(U,2),ft=f(je);ft.__click=[Vt,Ve,N],p(je),p(F),p(ce),Et(2),Z(()=>{Ge(ne,"src",t(N).data.navSrc),Ge(ne,"alt",t(N).name)}),b(B,re)}),p(H),p(D),V("click",k,()=>_(de,!1),!0),be(3,D,()=>xe,()=>x),b(v,g)};R(Oe,v=>{t(de)&&v(dt)})}var ut=h(Oe,2);{var gt=v=>{var g=na(),k=f(g),D=h(f(k),2);$t(D,()=>t(P));var A=h(D,2),z=f(A);{var le=B=>{var N=ye(),re=K(N);{var ce=F=>{var U=Xt();b(F,U)},ne=F=>{var U=ta();U.__click=[ea,Y],b(F,U)};R(re,F=>{t(Y)?F(ce):F(ne,!1)})}b(B,N)},H=B=>{var N=la();N.__click=[aa,Q,P],b(B,N)};R(z,B=>{t(Q)?B(le):B(H,!1)})}p(A),p(k),p(g),b(v,g)};R(ut,v=>{(t(Q)||t(P))&&v(gt)})}V("change",i,v=>v.target!=document.activeElement?Te(X(v),!0):{},!0),V("change",E,v=>t(d).title=X(v),!0),V("change",q,v=>t(d).date=X(v),!0),b(e,a)},rt=e=>{var a=ga(),l=f(a),n=f(l);{var i=r=>{var c=ra(),m=K(c);m.__click=[sa,Pe];var w=h(m,2);w.__change=[oa,nt],b(r,c)},o=r=>{var c=ye(),m=K(c);{var w=y=>{var q=da(),G=h(K(q),2),fe=f(G);fe.__click=[ca,_e],p(G);var ae=h(G,2),me=f(ae);me.__click=[va,it],p(ae),b(y,q)},E=y=>{var q=ua();b(y,q)};R(m,y=>{t(we)?y(w):y(E,!1)})}b(r,c)};R(n,r=>{t(W)?r(o,!1):r(i)})}p(l),p(a),b(e,a)};R(st,e=>{t(ke)?e(ot):e(rt,!1)})}ze("innerWidth",e=>_(I,e,!0)),ze("innerHeight",e=>_(ie,e,!0)),b(u,Ae),Ct()}Pt(["input","click","change"]);export{Sa as component,ka as universal};
