import"../chunks/DsnmJJEf.js";import{o as ft,s as qe}from"../chunks/BWE3rs_R.js";import{v as Y,h as $e,a as je,a2 as mt,ar as ht,k as Fe,O as yt,Q as bt,T as xt,R as wt,a1 as Re,s as kt,as as St,C as ce,l as It,m as Pt,t as T,aj as Dt,J as me,o as U,w as y,x as Tt,q as _,z as e,n as S,K as J,y as h,u as f,A as p,B as V,at as Ct}from"../chunks/DqVZNpwN.js";import{i as R}from"../chunks/CMLcb2m1.js";import{b as Be,e as Le,i as Ke,s as Ue,t as he,a as ye}from"../chunks/BHdDEesX.js";import{b as Et,a as At,s as Je}from"../chunks/Duc2o9yF.js";import{I as Ot}from"../chunks/DBrIpZCh.js";function Nt(u,s,b=!1,I=!1,ne=!1){var q=u,M="";Y(()=>{var B=mt;if(M===(M=s()??"")){$e&&je();return}if(B.nodes_start!==null&&(ht(B.nodes_start,B.nodes_end),B.nodes_start=B.nodes_end=null),M!==""){if($e){Fe.data;for(var C=je(),ie=C;C!==null&&(C.nodeType!==yt||C.data!=="");)ie=C,C=bt(C);if(C===null)throw xt(),wt;Re(Fe,ie),q=kt(C);return}var N=M+"";b?N=`<svg>${N}</svg>`:I&&(N=`<math>${N}</math>`);var $=St(N);if((b||I)&&($=ce($)),Re(ce($),$.lastChild),b||I)for(;ce($);)q.before(ce($));else q.before($)}})}const qt=async({fetch:u})=>({collections:await(await u("/collections/all.json")).json()}),ba=Object.freeze(Object.defineProperty({__proto__:null,load:qt},Symbol.toStringTag,{value:"Module"}));function Ge(u){return new Promise((s,b)=>{const I=document.createElement("script");I.src=u,document.body.appendChild(I),I.addEventListener("load",()=>s(I)),I.addEventListener("error",()=>b(I))})}var $t=(u,s,b)=>!u.inputType||u.inputType=="insertReplacementText"?s(b(u),!0):{},jt=S("<option></option>"),Ft=S('<span class="post-id svelte-5xvg81">-- Getting post ID --</span>'),Rt=S('<span class="post-id svelte-5xvg81"> </span>'),Bt=(u,s)=>_(s,!0),Lt=(u,s)=>s(),Kt=(u,s)=>s(),Ut=S('<div class="overlay svelte-5xvg81"><div class="overlay svelte-5xvg81"></div> <div><textarea class="content-input svelte-5xvg81" id="contentTextArea" placeholder="Add post content..."></textarea> <div class="content-bottom svelte-5xvg81"><button class="add-button svelte-5xvg81">Upload All</button></div></div></div>'),Jt=(u,s)=>_(s,!0),Gt=S("<div> </div>"),zt=(u,s)=>s("chooseImages"),Ht=(u,s)=>s(u),Mt=(u,s,b)=>s(e(b),-1),Wt=(u,s,b)=>s(e(b),1),Qt=(u,s,b)=>s(e(b)),Vt=S('<div class="image-preview-container svelte-5xvg81"><img class="image-preview svelte-5xvg81"/> <div class="overlay svelte-5xvg81"><div class="right-align svelte-5xvg81"><div class="svelte-5xvg81"><button class="image-preview-button svelte-5xvg81">↑</button></div> <div class="bottom-right svelte-5xvg81"><button class="image-preview-button svelte-5xvg81">↓</button></div></div> <div class="left-align svelte-5xvg81"><button class="image-preview-button red-button svelte-5xvg81">-</button></div></div></div> <div class="small-margins svelte-5xvg81"></div>',1),Yt=S('<div class="overlay svelte-5xvg81"></div> <div class="image-edit-popout svelte-5xvg81"><div class="small-margins svelte-5xvg81"><button class="add-button fill-width svelte-5xvg81">Add Images...</button> <input id="chooseImages" type="file" accept="image/*" multiple style="display:none;"/></div> <div class="small-margins bottom-line svelte-5xvg81"></div> <div class="small-margins svelte-5xvg81"></div></div>',1),Xt=S("<p>Cancelling...</p>"),Zt=(u,s)=>_(s,!0),ea=S('<button class="add-button red-button svelte-5xvg81">Cancel</button>'),ta=(u,s,b)=>{_(s,!1),_(b,"")},aa=S('<button class="add-button svelte-5xvg81">Done</button>'),la=S('<div class="overlay-darken center-parent svelte-5xvg81"><div class="center-login svelte-5xvg81"><h3>Uploading...</h3> <!> <div class="small-padding svelte-5xvg81"><!></div></div></div>'),na=S('<!> <div class="header svelte-5xvg81"><input class="collection-input svelte-5xvg81" id="inputCollection" list="collectionList" placeholder="Collection"/> <datalist id="collectionList"></datalist> <!> <div class="svelte-5xvg81"><input class="title-input svelte-5xvg81" id="inputTitle" placeholder="Title" size="35"/></div> <div class="svelte-5xvg81"><input class="small-input svelte-5xvg81" id="inputDate" placeholder="Date"/></div> <div class="svelte-5xvg81"><button class="add-button svelte-5xvg81">Edit Images...</button></div> <div class="small-vertical-padding svelte-5xvg81"><button class="add-button red-button svelte-5xvg81">Clear Post Data</button></div></div> <!> <!> <!>',1),ia=(u,s)=>s("chooseAuthKeyFile"),sa=(u,s)=>s(u),oa=S('<button class="add-button svelte-5xvg81">Load API Key</button> <input id="chooseAuthKeyFile" type="file" accept=".txt" multiple style="display:none;"/>',1),ra=(u,s)=>s(),ca=(u,s)=>s(),va=S('<h1 class="title svelte-5xvg81">Login</h1> <div class="small-padding svelte-5xvg81"><button class="add-button svelte-5xvg81">Authenticate</button></div> <div class="small-padding svelte-5xvg81"><button class="add-button red-button svelte-5xvg81">Remove API Key</button></div>',1),da=S('<h1 class="title svelte-5xvg81">Loading...</h1>'),ua=S('<div class="overlay-darken center-parent svelte-5xvg81"><div class="center-login svelte-5xvg81"><!></div></div>');function xa(u,s){Pt(s,!0);const b={duration:200,x:-100,opacity:0};let I=T(0),ne=T(0),q=J(()=>e(I)<=e(ne)),M=J(()=>e(I)/e(ne)>=2),B=J(()=>e(q)?{duration:200,y:100,opactiy:0}:{duration:200,x:100,opacity:0}),C=J(()=>e(q)?"content-container-portrait":"content-container"),ie=J(()=>e(q)?"edge-container-portrait":"edge-container"),N=T(!1),$=J(()=>e(N)?e(q)?"expanded-portrait":e(M)?"expanded-ultrawide":"expanded":""),ze=J(()=>e(q)?"↑":"←"),ve=T(!1),de,W=T(""),be=T(!1),xe=T(!1),X=T(!1),Q=T(!1),P=T(""),He=T(!1),ue=T(!1),we={id:"",collection:"",date:"",title:"",content:"",contentParagraphs:[],images:[]},d=T(Dt(we));function Me(t){let a=t.target;if(!(!a||!a.files))for(let l=0;l<a.files.length;++l){let n=a.files[l];const i=new FileReader;i.onload=function(){if(i.result){const o={data:i.result.toString(),name:n.name},r={name:n.name,data:{src:o.data,collageSrc:"",navSrc:""}};e(d).images.push(r),tt(r)}},i.readAsDataURL(n)}}function We(t){e(d).images=e(d).images.filter(a=>a!=t)}function ke(t,a){let l=e(d).images.findIndex(i=>i==t);if(l<0)return;let n=l+a;n>=e(d).images.length||e(d).images.splice(n,0,e(d).images.splice(l,1)[0])}function Se(t){let a=document.getElementById(t);a&&a.click()}function Z(t){let a=t.target;return a?a.value:""}function Qe(t){e(d).content=t,e(d).contentParagraphs=t.split(`
`)}function Ve(){_(d,we,!0);let t=document.getElementById("inputTitle");t.value="";let a=document.getElementById("inputDate");a.value="";let l=document.getElementById("inputCollection");l.value="";let n=document.getElementById("contentTextArea");n.value=""}async function ge(t){const l=await(await fetch(t).then(n=>n.blob())).arrayBuffer();return new Uint8Array(l)}async function Ie(t,a){let l=document.createElement("canvas"),n=l.getContext("2d");if(!n)return null;const i=a/(t.width/t.height);let o=Math.min(a/t.width,i/t.height),r=t.width*o,c=t.height*o;return l.width=r,l.height=c,n.drawImage(t,0,0,r,c),l.toDataURL("image/jpeg")}function Pe(t,a){e(d).collection=t,a&&Xe()}async function ee(t,a=!1){let l=t.split("/"),n="root";for(let i=0;i<l.length;++i){let o=l[i],r=`'${n}' in parents and name = '${o}' and mimeType = 'application/vnd.google-apps.folder' and trashed = false`,c=await gapi.client.request({path:`/drive/v3/files?q=${encodeURI(r)}`,method:"GET"});if(!c)return null;let m=JSON.parse(c.body);if(!m.files||m.files.length==0){if(a){let E=JSON.stringify({name:o,parents:[n],mimeType:"application/vnd.google-apps.folder"});if(!await gapi.client.request({path:"/drive/v3/files",method:"POST",body:E,headers:{"content-type":"application/json","content-length":E.length}}))return null;--i;continue}return null}n=m.files[0].id}return n}async function Ye(){let t=`BlogData/Posts/${e(d).collection}`,a=`${e(d).collection}-01`,l=await ee(t);if(!l)return a;let n=`'${l}' in parents and mimeType != 'application/vnd.google-apps.folder'`,i=await gapi.client.request({path:"/drive/v3/files",params:{q:n},method:"GET"});if(!i)return a;let o=JSON.parse(i.body);if(!o.files||o.files.length==0)return a;o.files.sort((w,j)=>w.name<j.name?-1:w.name>j.name?1:0);let c=o.files[o.files.length-1].name.split("."),x=c[c.length-2].match(/(?:\d+)(?!.*\d)/),E=x?x[0]:null;return E?`${e(d).collection}-${String(Number(E)+1).padStart(2,"0")}`:a}async function De(t){let a=t.split("/"),l=a.slice(0,-1).join("/"),n=a[a.length-1],i=await ee(l);if(!i)return null;let o=`'${i}' in parents and name = '${n}'`,r=await gapi.client.request({path:"/drive/v3/files",params:{q:o},method:"GET"});if(!r)return null;let c=JSON.parse(r.body);return!c.files||c.files.length==0?null:c.files[0].id}async function Xe(){_(ue,!0);let t=await Ye();e(d).id=t,_(ue,!1)}async function Ze(){_(Q,!1),_(X,!0),_(P,"");let t=!0,a=JSON.parse(JSON.stringify(e(d)));a.images=new Array(e(d).images.length),a.contentParagraphs=void 0;let l=`BlogData/Photos/${a.collection}`,n=await ee(l);for(let o=0;o<e(d).images.length&&!e(Q);++o){let r=e(d).images[o];_(P,e(P)+`Uploading images for '${r.name}'... `);let c=await et(r,n);if(t=!!c,_(P,e(P)+((t?"Success":"Failed")+"<br>")),!t||!c)break;a.images[o]=c}l=`BlogData/Posts/${a.collection}`;let i=`${l}/${a.id}.json`;if(t&&!e(Q)){let o=JSON.stringify(a),r=new TextEncoder;_(P,e(P)+`Uploading '${i}'... `);let c=await se(i,null,r.encode(o));_(P,e(P)+(c?"Success":"Failed"))}e(Q)&&_(P,e(P)+"Cancelled"),_(X,!1)}async function et(t,a){let l={src:"",collageSrc:"",navSrc:""},n=t.name.split("."),i=n[0],o=`BlogData/Photos/${e(d).collection}`;a||(a=await ee(o,!0));let r=await ge(t.data.src),c=`${o}/${t.name}`,m=await se(c,a,r);if(m)l.src=`https://lh3.googleusercontent.com/d/${m}?authuser=0`;else return null;let x=i+"_w1000."+n[1];if(c=`BlogData/Photos/${e(d).collection}/${x}`,r=await ge(t.data.collageSrc),m=await se(c,a,r),m)l.collageSrc=`https://lh3.googleusercontent.com/d/${m}?authuser=0`;else return null;if(x=i+"_w200."+n[1],c=`BlogData/Photos/${e(d).collection}/${x}`,r=await ge(t.data.navSrc),m=await se(c,a,r),m)l.navSrc=`https://lh3.googleusercontent.com/d/${m}?authuser=0`;else return null;return l}async function tt(t){const a={collageSrc:1e3,navSrc:200};let l=new Image,n=new Promise((r,c)=>{l.onload=()=>{r(l)},l.onerror=()=>{c()}});l.src=t.data.src,await n;let i=await Ie(l,a.collageSrc),o=e(d).images.find(r=>r.name==t.name);i&&o&&(o.data.collageSrc=i),i=await Ie(l,a.navSrc),i&&o&&(o.data.navSrc=i)}async function se(t,a,l){let n=await De(t);if(n)return n;let i=t.split("/"),o=i[i.length-1];if(!a){let w=i.slice(0,-1).join("/");a=await ee(w,!0)}let c=JSON.stringify({name:o,parents:[a]}),m=await gapi.client.request({path:"/upload/drive/v3/files?uploadType=resumable",method:"POST",body:c,headers:{"content-type":"application/json","content-length":c.length,"x-upload-content-length":l.byteLength}});if(!m||!m.headers)return null;let E=JSON.parse(JSON.stringify(m.headers)).location;try{await fetch(E,{method:"PUT",body:l,headers:{"content-length":l.byteLength.toString()}})}catch{}return n=await De(t),n}async function Te(){await gapi.client.init({apiKey:e(W)}),de=google.accounts.oauth2.initTokenClient({client_id:"953825518423-opf6ljfsqvslodfru7ugocm5ps5rgacp.apps.googleusercontent.com",scope:"https://www.googleapis.com/auth/drive.file",callback:async t=>{if(t.error!==void 0)throw alert(`Failed to authenticate: ${t}`),t;_(xe,!0)}}),_(be,!0)}function at(t){let a=t.target;if(!a||!a.files||a.files.length==0)return;let l=a.files[0];const n=new FileReader;n.onload=function(){n.result&&(_(W,n.result.toString(),!0),localStorage.setItem("apiKey",e(W)),gapi.load("client",Te))},n.readAsText(l)}function lt(){localStorage.removeItem("apiKey"),_(W,"")}function nt(){gapi.client.getToken()===null?de.requestAccessToken({prompt:"consent"}):de.requestAccessToken({prompt:""})}ft(async()=>{await Ge("https://apis.google.com/js/api.js"),await Ge("https://accounts.google.com/gsi/client");let t=localStorage.getItem("apiKey");t&&(_(W,t,!0),gapi.load("client",Te))});var Ce=me(),it=U(Ce);{var st=t=>{var a=na(),l=U(a);{let v=J(()=>e(d).images.map(g=>g.data));Ot(l,{get imagesData(){return e(v)}})}var n=h(l,2),i=f(n);i.__input=[$t,Pe,Z];var o=h(i,2);Le(o,21,()=>s.data.collections,Ke,(v,g)=>{var k=jt(),D={};Y(()=>{D!==(D=e(g).id)&&(k.value=(k.__value=e(g).id)??"")}),y(v,k)}),p(o);var r=h(o,2);{var c=v=>{var g=Ft();y(v,g)},m=v=>{var g=Rt(),k=f(g,!0);p(g),Y(()=>qe(k,e(d).id)),y(v,g)};R(r,v=>{e(ue)?v(c):v(m,!1)})}var x=h(r,2),E=f(x);p(x);var w=h(x,2),j=f(w);p(w);var G=h(w,2),pe=f(G);pe.__click=[Bt,ve],p(G);var te=h(G,2),_e=f(te);_e.__click=[Lt,Ve],p(te),p(n);var Ee=h(n,2);{var rt=v=>{var g=Ut(),k=f(g),D=h(k,2),A=f(D);Et(A);var z=h(A,2),ae=f(z);ae.__click=[Kt,Ze],p(z),p(D),p(g),Y(()=>{Ue(D,1,`${e(C)??""} ${e($)??""}`,"svelte-5xvg81"),At(A,e(d).content)}),V("click",k,()=>_(N,!1),!0),V("change",A,H=>{_(He,H.target==document.activeElement),Qe(Z(H))},!0),he(3,D,()=>ye,()=>e(B)),y(v,g)},ct=v=>{var g=Gt();g.__click=[Jt,N];var k=f(g,!0);p(g),Y(()=>{Ue(g,1,e(ie),"svelte-5xvg81"),qe(k,e(ze))}),he(3,g,()=>ye,()=>e(B)),y(v,g)};R(Ee,v=>{e(N)?v(rt):v(ct,!1)})}var Ae=h(Ee,2);{var vt=v=>{var g=Yt(),k=U(g),D=h(k,2),A=f(D),z=f(A);z.__click=[zt,Se];var ae=h(z,2);ae.__change=[Ht,Me],p(A);var H=h(A,4);Le(H,21,()=>e(d).images,Ke,(L,O)=>{var oe=Vt(),re=U(oe),le=f(re),F=h(le,2),K=f(F),fe=f(K),gt=f(fe);gt.__click=[Mt,ke,O],p(fe);var Oe=h(fe,2),pt=f(Oe);pt.__click=[Wt,ke,O],p(Oe),p(K);var Ne=h(K,2),_t=f(Ne);_t.__click=[Qt,We,O],p(Ne),p(F),p(re),Ct(2),Y(()=>{Je(le,"src",e(O).data.navSrc),Je(le,"alt",e(O).name)}),y(L,oe)}),p(H),p(D),V("click",k,()=>_(ve,!1),!0),he(3,D,()=>ye,()=>b),y(v,g)};R(Ae,v=>{e(ve)&&v(vt)})}var dt=h(Ae,2);{var ut=v=>{var g=la(),k=f(g),D=h(f(k),2);Nt(D,()=>e(P));var A=h(D,2),z=f(A);{var ae=L=>{var O=me(),oe=U(O);{var re=F=>{var K=Xt();y(F,K)},le=F=>{var K=ea();K.__click=[Zt,Q],y(F,K)};R(oe,F=>{e(Q)?F(re):F(le,!1)})}y(L,O)},H=L=>{var O=aa();O.__click=[ta,X,P],y(L,O)};R(z,L=>{e(X)?L(ae):L(H,!1)})}p(A),p(k),p(g),y(v,g)};R(dt,v=>{(e(X)||e(P))&&v(ut)})}V("change",i,v=>v.target!=document.activeElement?Pe(Z(v),!0):{},!0),V("change",E,v=>e(d).title=Z(v),!0),V("change",j,v=>e(d).date=Z(v),!0),y(t,a)},ot=t=>{var a=ua(),l=f(a),n=f(l);{var i=r=>{var c=oa(),m=U(c);m.__click=[ia,Se];var x=h(m,2);x.__change=[sa,at],y(r,c)},o=r=>{var c=me(),m=U(c);{var x=w=>{var j=va(),G=h(U(j),2),pe=f(G);pe.__click=[ra,nt],p(G);var te=h(G,2),_e=f(te);_e.__click=[ca,lt],p(te),y(w,j)},E=w=>{var j=da();y(w,j)};R(m,w=>{e(be)?w(x):w(E,!1)})}y(r,c)};R(n,r=>{e(W)?r(o,!1):r(i)})}p(l),p(a),y(t,a)};R(it,t=>{e(xe)?t(st):t(ot,!1)})}Be("innerWidth",t=>_(I,t,!0)),Be("innerHeight",t=>_(ne,t,!0)),y(u,Ce),Tt()}It(["input","click","change"]);export{xa as component,ba as universal};
