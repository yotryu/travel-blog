import"../chunks/DsnmJJEf.js";import{o as ft,s as qe}from"../chunks/BWE3rs_R.js";import{v as Y,h as je,a as Fe,a2 as mt,ar as ht,k as Re,O as yt,Q as bt,T as xt,R as wt,a1 as Le,s as kt,as as It,C as oe,l as St,m as Pt,t as T,aj as Dt,J as me,o as U,w as h,x as Tt,q as _,z as e,n as w,K as J,y as m,u as f,A as p,B as V,at as Ct}from"../chunks/DqVZNpwN.js";import{i as L}from"../chunks/CMLcb2m1.js";import{b as $e,e as Be,i as Ke,s as Ue,t as he,a as ye}from"../chunks/BHdDEesX.js";import{b as Et,a as At,s as Je}from"../chunks/Duc2o9yF.js";import{I as Ot}from"../chunks/DBrIpZCh.js";function Nt(d,r,y=!1,I=!1,le=!1){var q=d,M="";Y(()=>{var $=mt;if(M===(M=r()??"")){je&&Fe();return}if($.nodes_start!==null&&(ht($.nodes_start,$.nodes_end),$.nodes_start=$.nodes_end=null),M!==""){if(je){Re.data;for(var C=Fe(),ne=C;C!==null&&(C.nodeType!==yt||C.data!=="");)ne=C,C=bt(C);if(C===null)throw xt(),wt;Le(Re,ne),q=kt(C);return}var O=M+"";y?O=`<svg>${O}</svg>`:I&&(O=`<math>${O}</math>`);var j=It(O);if((y||I)&&(j=oe(j)),Le(oe(j),j.lastChild),y||I)for(;oe(j);)q.before(oe(j));else q.before(j)}})}const qt=async({fetch:d})=>({collections:await(await d("/collections/all.json")).json()}),ba=Object.freeze(Object.defineProperty({__proto__:null,load:qt},Symbol.toStringTag,{value:"Module"}));function Ge(d){return new Promise((r,y)=>{const I=document.createElement("script");I.src=d,document.body.appendChild(I),I.addEventListener("load",()=>r(I)),I.addEventListener("error",()=>y(I))})}var jt=(d,r,y)=>!d.inputType||d.inputType=="insertReplacementText"?r(y(d),!0):{},Ft=w("<option></option>"),Rt=w('<span class="post-id svelte-5xvg81">-- Getting post ID --</span>'),Lt=w('<span class="post-id svelte-5xvg81"> </span>'),$t=(d,r)=>_(r,!0),Bt=(d,r)=>r(),Kt=(d,r)=>r(),Ut=w('<div class="overlay svelte-5xvg81"><div class="overlay svelte-5xvg81"></div> <div><textarea class="content-input svelte-5xvg81" id="contentTextArea" placeholder="Add post content..."></textarea> <div class="content-bottom svelte-5xvg81"><button class="add-button svelte-5xvg81">Upload All</button></div></div></div>'),Jt=(d,r)=>_(r,!0),Gt=w("<div> </div>"),zt=(d,r)=>r("chooseImages"),Ht=(d,r)=>r(d),Mt=(d,r,y)=>r(e(y),-1),Wt=(d,r,y)=>r(e(y),1),Qt=(d,r,y)=>r(e(y)),Vt=w('<div class="image-preview-container svelte-5xvg81"><img class="image-preview svelte-5xvg81"/> <div class="overlay svelte-5xvg81"><div class="right-align svelte-5xvg81"><div class="svelte-5xvg81"><button class="image-preview-button svelte-5xvg81">↑</button></div> <div class="bottom-right svelte-5xvg81"><button class="image-preview-button svelte-5xvg81">↓</button></div></div> <div class="left-align svelte-5xvg81"><button class="image-preview-button red-button svelte-5xvg81">-</button></div></div></div> <div class="small-margins svelte-5xvg81"></div>',1),Yt=w('<div class="overlay svelte-5xvg81"></div> <div class="image-edit-popout svelte-5xvg81"><div class="small-margins svelte-5xvg81"><button class="add-button fill-width svelte-5xvg81">Add Images...</button> <input id="chooseImages" type="file" accept="image/*" multiple style="display:none;"/></div> <div class="small-margins bottom-line svelte-5xvg81"></div> <div class="small-margins svelte-5xvg81"></div></div>',1),Xt=w("<p>Cancelling...</p>"),Zt=(d,r)=>_(r,!0),ea=w('<button class="add-button red-button svelte-5xvg81">Cancel</button>'),ta=(d,r,y)=>{_(r,!1),_(y,"")},aa=w('<button class="add-button svelte-5xvg81">Done</button>'),la=w('<div class="overlay-darken center-parent svelte-5xvg81"><div class="center-login svelte-5xvg81"><h3>Uploading...</h3> <!> <div class="small-padding svelte-5xvg81"><!></div></div></div>'),na=w('<!> <div class="header svelte-5xvg81"><input class="collection-input svelte-5xvg81" id="inputCollection" list="collectionList" placeholder="Collection"/> <datalist id="collectionList"></datalist> <!> <div class="svelte-5xvg81"><input class="title-input svelte-5xvg81" id="inputTitle" placeholder="Title" size="35"/></div> <div class="svelte-5xvg81"><input class="small-input svelte-5xvg81" id="inputDate" placeholder="Date"/></div> <div class="svelte-5xvg81"><button class="add-button svelte-5xvg81">Edit Images...</button></div> <div class="small-vertical-padding svelte-5xvg81"><button class="add-button red-button svelte-5xvg81">Clear Post Data</button></div></div> <!> <!> <!>',1),ia=(d,r)=>r("chooseAuthKeyFile"),sa=(d,r)=>r(d),ra=w('<button class="add-button svelte-5xvg81">Load API Key</button> <input id="chooseAuthKeyFile" type="file" accept=".txt" multiple style="display:none;"/>',1),oa=(d,r)=>r(),ca=(d,r)=>r(),va=w('<h1 class="title svelte-5xvg81">Login</h1> <div class="small-padding svelte-5xvg81"><button class="add-button svelte-5xvg81">Authenticate</button></div> <div class="small-padding svelte-5xvg81"><button class="add-button red-button svelte-5xvg81">Remove API Key</button></div>',1),da=w('<h1 class="title svelte-5xvg81">Loading...</h1>'),ua=w('<div class="overlay-darken center-parent svelte-5xvg81"><div class="center-login svelte-5xvg81"><!></div></div>');function xa(d,r){Pt(r,!0);const y={duration:200,x:-100,opacity:0};let I=T(0),le=T(0),q=J(()=>e(I)<=e(le)),M=J(()=>e(I)/e(le)>=2),$=J(()=>e(q)?{duration:200,y:100,opactiy:0}:{duration:200,x:100,opacity:0}),C=J(()=>e(q)?"content-container-portrait":"content-container"),ne=J(()=>e(q)?"edge-container-portrait":"edge-container"),O=T(!1),j=J(()=>e(O)?e(q)?"expanded-portrait":e(M)?"expanded-ultrawide":"expanded":""),ze=J(()=>e(q)?"↑":"←"),ce=T(!1),ve,W=T(""),be=T(!1),xe=T(!1),X=T(!1),Q=T(!1),S=T(""),He=T(!1),de=T(!1),we={id:"",collection:"",date:"",title:"",content:"",contentParagraphs:[],images:[]},v=T(Dt(we));function Me(t){let a=t.target;if(!(!a||!a.files))for(let l=0;l<a.files.length;++l){let n=a.files[l];const i=new FileReader;i.onload=function(){if(i.result){const s={data:i.result.toString(),name:n.name},o={name:n.name,data:{src:s.data,collageSrc:"",navSrc:""}};e(v).images.push(o),tt(o)}},i.readAsDataURL(n)}}function We(t){e(v).images=e(v).images.filter(a=>a!=t)}function ke(t,a){let l=e(v).images.findIndex(i=>i==t);if(l<0)return;let n=l+a;n>=e(v).images.length||e(v).images.splice(n,0,e(v).images.splice(l,1)[0])}function Ie(t){let a=document.getElementById(t);a&&a.click()}function Z(t){let a=t.target;return a?a.value:""}function Qe(t){e(v).content=t,e(v).contentParagraphs=t.split(`
`)}function Ve(){_(v,we,!0);let t=document.getElementById("inputTitle");t.value="";let a=document.getElementById("inputDate");a.value="";let l=document.getElementById("inputCollection");l.value="";let n=document.getElementById("contentTextArea");n.value=""}async function ue(t){const l=await(await fetch(t).then(n=>n.blob())).arrayBuffer();return new Uint8Array(l)}async function Se(t,a){let l=document.createElement("canvas"),n=l.getContext("2d");if(!n)return null;const i=a/(t.width/t.height);let s=Math.min(a/t.width,i/t.height),o=t.width*s,g=t.height*s;return l.width=o,l.height=g,n.drawImage(t,0,0,o,g),l.toDataURL("image/jpeg")}function Pe(t,a){e(v).collection=t,a&&Xe()}async function ge(t,a=!1){let l=t.split("/"),n="root";for(let i=0;i<l.length;++i){let s=l[i],o=`'${n}' in parents and name = '${s}' and mimeType = 'application/vnd.google-apps.folder' and trashed = false`,g=await gapi.client.request({path:`/drive/v3/files?q=${encodeURI(o)}`,method:"GET"});if(!g)return null;let P=JSON.parse(g.body);if(!P.files||P.files.length==0){if(a){let N=JSON.stringify({name:s,parents:[n],mimeType:"application/vnd.google-apps.folder"});if(!await gapi.client.request({path:"/drive/v3/files",method:"POST",body:N,headers:{"content-type":"application/json","content-length":N.length}}))return null;--i;continue}return null}n=P.files[0].id}return n}async function Ye(){let t=`BlogData/Posts/${e(v).collection}`,a=`${e(v).collection}-01`,l=await ge(t);if(!l)return a;let n=`'${l}' in parents and mimeType != 'application/vnd.google-apps.folder'`,i=await gapi.client.request({path:"/drive/v3/files",params:{q:n},method:"GET"});if(!i)return a;let s=JSON.parse(i.body);if(!s.files||s.files.length==0)return a;s.files.sort((b,F)=>b.name<F.name?-1:b.name>F.name?1:0);let g=s.files[s.files.length-1].name.split("."),k=g[g.length-2].match(/(?:\d+)(?!.*\d)/),N=k?k[0]:null;return N?`${e(v).collection}-${String(Number(N)+1).padStart(2,"0")}`:a}async function De(t){let a=t.split("/"),l=a.slice(0,-1).join("/"),n=a[a.length-1],i=await ge(l);if(!i)return null;let s=`'${i}' in parents and name = '${n}'`,o=await gapi.client.request({path:"/drive/v3/files",params:{q:s},method:"GET"});if(!o)return null;let g=JSON.parse(o.body);return!g.files||g.files.length==0?null:g.files[0].id}async function Xe(){_(de,!0);let t=await Ye();e(v).id=t,_(de,!1)}async function Ze(){_(Q,!1),_(X,!0),_(S,"");let t=!0,a=JSON.parse(JSON.stringify(e(v)));a.images=new Array(e(v).images.length),a.contentParagraphs=void 0;for(let n=0;n<e(v).images.length&&!e(Q);++n){let i=e(v).images[n];_(S,e(S)+`Uploading images for '${i.name}'... `);let s=await et(i);if(t=!!s,_(S,e(S)+((t?"Success":"Failed")+"<br>")),!t||!s)break;a.images[n]=s}let l=`BlogData/Posts/${a.collection}/${a.id}.json`;if(t&&!e(Q)){let n=JSON.stringify(a),i=new TextEncoder;_(S,e(S)+`Uploading '${l}'... `);let s=await ie(l,i.encode(n));_(S,e(S)+(s?"Success":"Failed"))}e(Q)&&_(S,e(S)+"Cancelled"),_(X,!1)}async function et(t){let a={src:"",collageSrc:"",navSrc:""},l=t.name.split("."),n=l[0],i=await ue(t.data.src),s=`BlogData/Photos/${e(v).collection}/${t.name}`,o=await ie(s,i);if(o)a.src=`https://lh3.googleusercontent.com/d/${o}?authuser=0`;else return null;let g=n+"_w1000."+l[1];if(s=`BlogData/Photos/${e(v).collection}/${g}`,i=await ue(t.data.collageSrc),o=await ie(s,i),o)a.collageSrc=`https://lh3.googleusercontent.com/d/${o}?authuser=0`;else return null;if(g=n+"_w200."+l[1],s=`BlogData/Photos/${e(v).collection}/${g}`,i=await ue(t.data.navSrc),o=await ie(s,i),o)a.navSrc=`https://lh3.googleusercontent.com/d/${o}?authuser=0`;else return null;return a}async function tt(t){const a={collageSrc:1e3,navSrc:200};let l=new Image,n=new Promise((o,g)=>{l.onload=()=>{o(l)},l.onerror=()=>{g()}});l.src=t.data.src,await n;let i=await Se(l,a.collageSrc),s=e(v).images.find(o=>o.name==t.name);i&&s&&(s.data.collageSrc=i),i=await Se(l,a.navSrc),i&&s&&(s.data.navSrc=i)}async function ie(t,a){let l=await De(t);if(l)return l;let n=t.split("/"),i=n[n.length-1],s=n.slice(0,-1).join("/"),o=await ge(s,!0),P=JSON.stringify({name:i,parents:[o]}),k=await gapi.client.request({path:"/upload/drive/v3/files?uploadType=resumable",method:"POST",body:P,headers:{"content-type":"application/json","content-length":P.length,"x-upload-content-length":a.byteLength}});if(!k||!k.headers)return null;let b=JSON.parse(JSON.stringify(k.headers)).location;try{await fetch(b,{method:"PUT",body:a,headers:{"content-length":a.byteLength.toString()}})}catch{}return l=await De(t),l}async function Te(){await gapi.client.init({apiKey:e(W)}),ve=google.accounts.oauth2.initTokenClient({client_id:"953825518423-opf6ljfsqvslodfru7ugocm5ps5rgacp.apps.googleusercontent.com",scope:"https://www.googleapis.com/auth/drive.file",callback:async t=>{if(t.error!==void 0)throw alert(`Failed to authenticate: ${t}`),t;_(xe,!0)}}),_(be,!0)}function at(t){let a=t.target;if(!a||!a.files||a.files.length==0)return;let l=a.files[0];const n=new FileReader;n.onload=function(){n.result&&(_(W,n.result.toString(),!0),localStorage.setItem("apiKey",e(W)),gapi.load("client",Te))},n.readAsText(l)}function lt(){localStorage.removeItem("apiKey"),_(W,"")}function nt(){gapi.client.getToken()===null?ve.requestAccessToken({prompt:"consent"}):ve.requestAccessToken({prompt:""})}ft(async()=>{await Ge("https://apis.google.com/js/api.js"),await Ge("https://accounts.google.com/gsi/client");let t=localStorage.getItem("apiKey");t&&(_(W,t,!0),gapi.load("client",Te))});var Ce=me(),it=U(Ce);{var st=t=>{var a=na(),l=U(a);{let c=J(()=>e(v).images.map(u=>u.data));Ot(l,{get imagesData(){return e(c)}})}var n=m(l,2),i=f(n);i.__input=[jt,Pe,Z];var s=m(i,2);Be(s,21,()=>r.data.collections,Ke,(c,u)=>{var x=Ft(),D={};Y(()=>{D!==(D=e(u).id)&&(x.value=(x.__value=e(u).id)??"")}),h(c,x)}),p(s);var o=m(s,2);{var g=c=>{var u=Rt();h(c,u)},P=c=>{var u=Lt(),x=f(u,!0);p(u),Y(()=>qe(x,e(v).id)),h(c,u)};L(o,c=>{e(de)?c(g):c(P,!1)})}var k=m(o,2),N=f(k);p(k);var b=m(k,2),F=f(b);p(b);var G=m(b,2),pe=f(G);pe.__click=[$t,ce],p(G);var ee=m(G,2),_e=f(ee);_e.__click=[Bt,Ve],p(ee),p(n);var Ee=m(n,2);{var ot=c=>{var u=Ut(),x=f(u),D=m(x,2),E=f(D);Et(E);var z=m(E,2),te=f(z);te.__click=[Kt,Ze],p(z),p(D),p(u),Y(()=>{Ue(D,1,`${e(C)??""} ${e(j)??""}`,"svelte-5xvg81"),At(E,e(v).content)}),V("click",x,()=>_(O,!1),!0),V("change",E,H=>{_(He,H.target==document.activeElement),Qe(Z(H))},!0),he(3,D,()=>ye,()=>e($)),h(c,u)},ct=c=>{var u=Gt();u.__click=[Jt,O];var x=f(u,!0);p(u),Y(()=>{Ue(u,1,e(ne),"svelte-5xvg81"),qe(x,e(ze))}),he(3,u,()=>ye,()=>e($)),h(c,u)};L(Ee,c=>{e(O)?c(ot):c(ct,!1)})}var Ae=m(Ee,2);{var vt=c=>{var u=Yt(),x=U(u),D=m(x,2),E=f(D),z=f(E);z.__click=[zt,Ie];var te=m(z,2);te.__change=[Ht,Me],p(E);var H=m(E,4);Be(H,21,()=>e(v).images,Ke,(B,A)=>{var se=Vt(),re=U(se),ae=f(re),R=m(ae,2),K=f(R),fe=f(K),gt=f(fe);gt.__click=[Mt,ke,A],p(fe);var Oe=m(fe,2),pt=f(Oe);pt.__click=[Wt,ke,A],p(Oe),p(K);var Ne=m(K,2),_t=f(Ne);_t.__click=[Qt,We,A],p(Ne),p(R),p(re),Ct(2),Y(()=>{Je(ae,"src",e(A).data.navSrc),Je(ae,"alt",e(A).name)}),h(B,se)}),p(H),p(D),V("click",x,()=>_(ce,!1),!0),he(3,D,()=>ye,()=>y),h(c,u)};L(Ae,c=>{e(ce)&&c(vt)})}var dt=m(Ae,2);{var ut=c=>{var u=la(),x=f(u),D=m(f(x),2);Nt(D,()=>e(S));var E=m(D,2),z=f(E);{var te=B=>{var A=me(),se=U(A);{var re=R=>{var K=Xt();h(R,K)},ae=R=>{var K=ea();K.__click=[Zt,Q],h(R,K)};L(se,R=>{e(Q)?R(re):R(ae,!1)})}h(B,A)},H=B=>{var A=aa();A.__click=[ta,X,S],h(B,A)};L(z,B=>{e(X)?B(te):B(H,!1)})}p(E),p(x),p(u),h(c,u)};L(dt,c=>{(e(X)||e(S))&&c(ut)})}V("change",i,c=>c.target!=document.activeElement?Pe(Z(c),!0):{},!0),V("change",N,c=>e(v).title=Z(c),!0),V("change",F,c=>e(v).date=Z(c),!0),h(t,a)},rt=t=>{var a=ua(),l=f(a),n=f(l);{var i=o=>{var g=ra(),P=U(g);P.__click=[ia,Ie];var k=m(P,2);k.__change=[sa,at],h(o,g)},s=o=>{var g=me(),P=U(g);{var k=b=>{var F=va(),G=m(U(F),2),pe=f(G);pe.__click=[oa,nt],p(G);var ee=m(G,2),_e=f(ee);_e.__click=[ca,lt],p(ee),h(b,F)},N=b=>{var F=da();h(b,F)};L(P,b=>{e(be)?b(k):b(N,!1)})}h(o,g)};L(n,o=>{e(W)?o(s,!1):o(i)})}p(l),p(a),h(t,a)};L(it,t=>{e(xe)?t(st):t(rt,!1)})}$e("innerWidth",t=>_(I,t,!0)),$e("innerHeight",t=>_(le,t,!0)),h(d,Ce),Tt()}St(["input","click","change"]);export{xa as component,ba as universal};
