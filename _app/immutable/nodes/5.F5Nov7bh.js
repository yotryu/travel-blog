import"../chunks/DsnmJJEf.js";import{o as ft,s as Ne}from"../chunks/Drnj-hpf.js";import{h as ye,J as ae,T as mt,x as Q,c as Fe,a1 as ht,at as bt,m as je,K as yt,O as xt,R as wt,P as It,a0 as Le,s as kt,au as St,n as Pt,o as Dt,v as C,ar as Ct,F as me,t as U,y as h,z as Tt,u as _,B as e,q as w,G as J,A as m,w as f,C as p,D as Y,av as Et}from"../chunks/Co3hCml5.js";import{i as R}from"../chunks/DPyqPMB2.js";import{b as Re,e as $e,i as Be,s as Ke,t as he,a as be}from"../chunks/CXvPUOk9.js";import{a as At,s as Ue}from"../chunks/83Z9ZpwJ.js";import{I as Ot}from"../chunks/CPz814e5.js";function qt(u){ye&&ae(u)!==null&&mt(u)}function Nt(u,o,b=!1,k=!1,le=!1){var N=u,M="";Q(()=>{var $=ht;if(M===(M=o()??"")){ye&&Fe();return}if($.nodes_start!==null&&(bt($.nodes_start,$.nodes_end),$.nodes_start=$.nodes_end=null),M!==""){if(ye){je.data;for(var T=Fe(),ne=T;T!==null&&(T.nodeType!==yt||T.data!=="");)ne=T,T=xt(T);if(T===null)throw wt(),It;Le(je,ne),N=kt(T);return}var O=M+"";b?O=`<svg>${O}</svg>`:k&&(O=`<math>${O}</math>`);var F=St(O);if((b||k)&&(F=ae(F)),Le(ae(F),F.lastChild),b||k)for(;ae(F);)N.before(ae(F));else N.before(F)}})}const Ft=async({fetch:u})=>({collections:await(await u("/collections/all.json")).json()}),ya=Object.freeze(Object.defineProperty({__proto__:null,load:Ft},Symbol.toStringTag,{value:"Module"}));function Je(u){return new Promise((o,b)=>{const k=document.createElement("script");k.src=u,document.body.appendChild(k),k.addEventListener("load",()=>o(k)),k.addEventListener("error",()=>b(k))})}var jt=w("<option></option>"),Lt=w('<span class="post-id svelte-5xvg81">-- Getting post ID --</span>'),Rt=w('<span class="post-id svelte-5xvg81"> </span>'),$t=(u,o)=>_(o,!0),Bt=(u,o)=>o(),Kt=(u,o)=>o(),Ut=w('<div class="overlay svelte-5xvg81"><div class="overlay svelte-5xvg81"></div> <div><textarea class="content-input svelte-5xvg81" id="contentTextArea" placeholder="Add post content..."></textarea> <div class="content-bottom svelte-5xvg81"><button class="add-button svelte-5xvg81">Upload All</button></div></div></div>'),Jt=(u,o)=>_(o,!0),Gt=w("<div> </div>"),zt=(u,o)=>o("chooseImages"),Ht=(u,o)=>o(u),Mt=(u,o,b)=>o(e(b),-1),Wt=(u,o,b)=>o(e(b),1),Vt=(u,o,b)=>o(e(b)),Yt=w('<div class="image-preview-container svelte-5xvg81"><img class="image-preview svelte-5xvg81"/> <div class="overlay svelte-5xvg81"><div class="right-align svelte-5xvg81"><div class="svelte-5xvg81"><button class="image-preview-button svelte-5xvg81">↑</button></div> <div class="bottom-right svelte-5xvg81"><button class="image-preview-button svelte-5xvg81">↓</button></div></div> <div class="left-align svelte-5xvg81"><button class="image-preview-button red-button svelte-5xvg81">-</button></div></div></div> <div class="small-margins svelte-5xvg81"></div>',1),Qt=w('<div class="overlay svelte-5xvg81"></div> <div class="image-edit-popout svelte-5xvg81"><div class="small-margins svelte-5xvg81"><button class="add-button fill-width svelte-5xvg81">Add Images...</button> <input id="chooseImages" type="file" accept="image/*" multiple style="display:none;"/></div> <div class="small-margins bottom-line svelte-5xvg81"></div> <div class="small-margins svelte-5xvg81"></div></div>',1),Xt=w("<p>Cancelling...</p>"),Zt=(u,o)=>_(o,!0),ea=w('<button class="add-button red-button svelte-5xvg81">Cancel</button>'),ta=(u,o,b)=>{_(o,!1),_(b,"")},aa=w('<button class="add-button svelte-5xvg81">Done</button>'),la=w('<div class="overlay-darken center-parent svelte-5xvg81"><div class="center-login svelte-5xvg81"><h3>Uploading...</h3> <!> <div class="small-padding svelte-5xvg81"><!></div></div></div>'),na=w('<!> <div class="header svelte-5xvg81"><input class="collection-input svelte-5xvg81" id="inputCollection" list="collectionList" placeholder="Collection"/> <datalist id="collectionList"></datalist> <!> <div class="svelte-5xvg81"><input class="title-input svelte-5xvg81" id="inputTitle" placeholder="Title" size="35"/></div> <div class="svelte-5xvg81"><input class="small-input svelte-5xvg81" id="inputDate" placeholder="Date"/></div> <div class="svelte-5xvg81"><button class="add-button svelte-5xvg81">Edit Images...</button></div> <div class="small-vertical-padding svelte-5xvg81"><button class="add-button red-button svelte-5xvg81">Clear Post Data</button></div></div> <!> <!> <!>',1),ia=(u,o)=>o("chooseAuthKeyFile"),sa=(u,o)=>o(u),oa=w('<button class="add-button svelte-5xvg81">Load API Key</button> <input id="chooseAuthKeyFile" type="file" accept=".txt" multiple style="display:none;"/>',1),ra=(u,o)=>o(),ca=(u,o)=>o(),va=w('<h1 class="title svelte-5xvg81">Login</h1> <div class="small-padding svelte-5xvg81"><button class="add-button svelte-5xvg81">Authenticate</button></div> <div class="small-padding svelte-5xvg81"><button class="add-button red-button svelte-5xvg81">Remove API Key</button></div>',1),da=w('<h1 class="title svelte-5xvg81">Loading...</h1>'),ua=w('<div class="overlay-darken center-parent svelte-5xvg81"><div class="center-login svelte-5xvg81"><!></div></div>');function xa(u,o){Dt(o,!0);const b={duration:200,x:-100,opacity:0};let k=C(0),le=C(0),N=J(()=>e(k)<=e(le)),M=J(()=>e(k)/e(le)>=2),$=J(()=>e(N)?{duration:200,y:100,opactiy:0}:{duration:200,x:100,opacity:0}),T=J(()=>e(N)?"content-container-portrait":"content-container"),ne=J(()=>e(N)?"edge-container-portrait":"edge-container"),O=C(!1),F=J(()=>e(O)?e(N)?"expanded-portrait":e(M)?"expanded-ultrawide":"expanded":""),Ge=J(()=>e(N)?"↑":"←"),ce=C(!1),ve,W=C(""),xe=C(!1),we=C(!1),X=C(!1),V=C(!1),S=C(""),ze=C(!1),de=C(!1),Ie={id:"",collection:"",date:"",title:"",content:"",contentParagraphs:[],images:[]},v=C(Ct(Ie));function He(t){let a=t.target;if(!(!a||!a.files))for(let l=0;l<a.files.length;++l){let n=a.files[l];const i=new FileReader;i.onload=function(){if(i.result){const s={data:i.result.toString(),name:n.name},r={name:n.name,data:{src:s.data,collageSrc:"",navSrc:""}};e(v).images.push(r),tt(r)}},i.readAsDataURL(n)}}function Me(t){e(v).images=e(v).images.filter(a=>a!=t)}function ke(t,a){let l=e(v).images.findIndex(i=>i==t);if(l<0)return;let n=l+a;n>=e(v).images.length||e(v).images.splice(n,0,e(v).images.splice(l,1)[0])}function Se(t){let a=document.getElementById(t);a&&a.click()}function ie(t){let a=t.target;return a?a.value:""}function We(t){e(v).content=t,e(v).contentParagraphs=t.split(`
`)}function Ve(){_(v,Ie,!0);let t=document.getElementById("inputTitle");t.value="";let a=document.getElementById("inputDate");a.value="";let l=document.getElementById("inputCollection");l.value="";let n=document.getElementById("contentTextArea");n.value=""}async function ue(t){const l=await(await fetch(t).then(n=>n.blob())).arrayBuffer();return new Uint8Array(l)}async function Pe(t,a){let l=document.createElement("canvas"),n=l.getContext("2d");if(!n)return null;const i=a/(t.width/t.height);let s=Math.min(a/t.width,i/t.height),r=t.width*s,g=t.height*s;return l.width=r,l.height=g,n.drawImage(t,0,0,r,g),l.toDataURL("image/jpeg")}function Ye(t,a){e(v).collection=t,Xe()}async function ge(t,a=!1){let l=t.split("/"),n="root";for(let i=0;i<l.length;++i){let s=l[i],r=`'${n}' in parents and name = '${s}' and mimeType = 'application/vnd.google-apps.folder' and trashed = false`,g=await gapi.client.request({path:`/drive/v3/files?q=${encodeURI(r)}`,method:"GET"});if(!g)return null;let P=JSON.parse(g.body);if(!P.files||P.files.length==0){if(a){let q=JSON.stringify({name:s,parents:[n],mimeType:"application/vnd.google-apps.folder"});if(!await gapi.client.request({path:"/drive/v3/files",method:"POST",body:q,headers:{"content-type":"application/json","content-length":q.length}}))return null;--i;continue}return null}n=P.files[0].id}return n}async function Qe(){let t=`BlogData/Posts/${e(v).collection}`,a=`${e(v).collection}-01`,l=await ge(t);if(!l)return a;let n=`'${l}' in parents and mimeType != 'application/vnd.google-apps.folder'`,i=await gapi.client.request({path:"/drive/v3/files",params:{q:n},method:"GET"});if(!i)return a;let s=JSON.parse(i.body);if(!s.files||s.files.length==0)return a;s.files.sort((y,j)=>y.name<j.name?-1:y.name>j.name?1:0);let g=s.files[s.files.length-1].name.split("."),I=g[g.length-2].match(/(?:\d+)(?!.*\d)/),q=I?I[0]:null;return q?`${e(v).collection}-${String(Number(q)+1).padStart(2,"0")}`:a}async function De(t){let a=t.split("/"),l=a.slice(0,-1).join("/"),n=a[a.length-1],i=await ge(l);if(!i)return null;let s=`'${i}' in parents and name = '${n}'`,r=await gapi.client.request({path:"/drive/v3/files",params:{q:s},method:"GET"});if(!r)return null;let g=JSON.parse(r.body);return!g.files||g.files.length==0?null:g.files[0].id}async function Xe(){_(de,!0);let t=await Qe();e(v).id=t,_(de,!1)}async function Ze(){_(V,!1),_(X,!0),_(S,"");let t=!0,a=JSON.parse(JSON.stringify(e(v)));a.images=new Array(e(v).images.length),a.contentParagraphs=void 0;for(let n=0;n<e(v).images.length&&!e(V);++n){let i=e(v).images[n];_(S,e(S)+`Uploading images for '${i.name}'... `);let s=await et(i);if(t=!!s,_(S,e(S)+((t?"Success":"Failed")+"<br>")),!t||!s)break;a.images[n]=s}let l=`BlogData/Posts/${a.collection}/${a.id}.json`;if(t&&!e(V)){let n=JSON.stringify(a),i=new TextEncoder;_(S,e(S)+`Uploading '${l}'... `);let s=await se(l,i.encode(n));_(S,e(S)+(s?"Success":"Failed"))}e(V)&&_(S,e(S)+"Cancelled"),_(X,!1)}async function et(t){let a={src:"",collageSrc:"",navSrc:""},l=t.name.split("."),n=l[0],i=await ue(t.data.src),s=`BlogData/Photos/${e(v).collection}/${t.name}`,r=await se(s,i);if(r)a.src=`https://lh3.googleusercontent.com/d/${r}?authuser=0`;else return null;let g=n+"_w1000."+l[1];if(s=`BlogData/Photos/${e(v).collection}/${g}`,i=await ue(t.data.collageSrc),r=await se(s,i),r)a.collageSrc=`https://lh3.googleusercontent.com/d/${r}?authuser=0`;else return null;if(g=n+"_w200."+l[1],s=`BlogData/Photos/${e(v).collection}/${g}`,i=await ue(t.data.navSrc),r=await se(s,i),r)a.navSrc=`https://lh3.googleusercontent.com/d/${r}?authuser=0`;else return null;return a}async function tt(t){const a={collageSrc:1e3,navSrc:200};let l=new Image,n=new Promise((r,g)=>{l.onload=()=>{r(l)},l.onerror=()=>{g()}});l.src=t.data.src,await n;let i=await Pe(l,a.collageSrc),s=e(v).images.find(r=>r.name==t.name);i&&s&&(s.data.collageSrc=i),i=await Pe(l,a.navSrc),i&&s&&(s.data.navSrc=i)}async function se(t,a){let l=await De(t);if(l)return l;let n=t.split("/"),i=n[n.length-1],s=n.slice(0,-1).join("/"),r=await ge(s,!0),P=JSON.stringify({name:i,parents:[r]}),I=await gapi.client.request({path:"/upload/drive/v3/files?uploadType=resumable",method:"POST",body:P,headers:{"content-type":"application/json","content-length":P.length,"x-upload-content-length":a.byteLength}});if(!I||!I.headers)return null;let y=JSON.parse(JSON.stringify(I.headers)).location;try{await fetch(y,{method:"PUT",body:a,headers:{"content-length":a.byteLength.toString()}})}catch{}return l=await De(t),l}async function Ce(){await gapi.client.init({apiKey:e(W)}),ve=google.accounts.oauth2.initTokenClient({client_id:"953825518423-opf6ljfsqvslodfru7ugocm5ps5rgacp.apps.googleusercontent.com",scope:"https://www.googleapis.com/auth/drive.file",callback:async t=>{if(t.error!==void 0)throw alert(`Failed to authenticate: ${t}`),t;_(we,!0)}}),_(xe,!0)}function at(t){let a=t.target;if(!a||!a.files||a.files.length==0)return;let l=a.files[0];const n=new FileReader;n.onload=function(){n.result&&(_(W,n.result.toString(),!0),localStorage.setItem("apiKey",e(W)),gapi.load("client",Ce))},n.readAsText(l)}function lt(){localStorage.removeItem("apiKey"),_(W,"")}function nt(){gapi.client.getToken()===null?ve.requestAccessToken({prompt:"consent"}):ve.requestAccessToken({prompt:""})}ft(async()=>{await Je("https://apis.google.com/js/api.js"),await Je("https://accounts.google.com/gsi/client");let t=localStorage.getItem("apiKey");t&&(_(W,t,!0),gapi.load("client",Ce))});var Te=me(),it=U(Te);{var st=t=>{var a=na(),l=U(a);{let c=J(()=>e(v).images.map(d=>d.data));Ot(l,{get imagesData(){return e(c)}})}var n=m(l,2),i=f(n),s=m(i,2);$e(s,21,()=>o.data.collections,Be,(c,d)=>{var x=jt(),D={};Q(()=>{D!==(D=e(d).id)&&(x.value=(x.__value=e(d).id)??"")}),h(c,x)}),p(s);var r=m(s,2);{var g=c=>{var d=Lt();h(c,d)},P=c=>{var d=Rt(),x=f(d,!0);p(d),Q(()=>Ne(x,e(v).id)),h(c,d)};R(r,c=>{e(de)?c(g):c(P,!1)})}var I=m(r,2),q=f(I);p(I);var y=m(I,2),j=f(y);p(y);var G=m(y,2),pe=f(G);pe.__click=[$t,ce],p(G);var Z=m(G,2),_e=f(Z);_e.__click=[Bt,Ve],p(Z),p(n);var Ee=m(n,2);{var rt=c=>{var d=Ut(),x=f(d),D=m(x,2),E=f(D);qt(E);var z=m(E,2),ee=f(z);ee.__click=[Kt,Ze],p(z),p(D),p(d),Q(()=>{Ke(D,1,`${e(T)??""} ${e(F)??""}`,"svelte-5xvg81"),At(E,e(v).content)}),Y("click",x,()=>_(O,!1),!0),Y("change",E,H=>{_(ze,H.target==document.activeElement),We(ie(H))},!0),he(3,D,()=>be,()=>e($)),h(c,d)},ct=c=>{var d=Gt();d.__click=[Jt,O];var x=f(d,!0);p(d),Q(()=>{Ke(d,1,e(ne),"svelte-5xvg81"),Ne(x,e(Ge))}),he(3,d,()=>be,()=>e($)),h(c,d)};R(Ee,c=>{e(O)?c(rt):c(ct,!1)})}var Ae=m(Ee,2);{var vt=c=>{var d=Qt(),x=U(d),D=m(x,2),E=f(D),z=f(E);z.__click=[zt,Se];var ee=m(z,2);ee.__change=[Ht,He],p(E);var H=m(E,4);$e(H,21,()=>e(v).images,Be,(B,A)=>{var oe=Yt(),re=U(oe),te=f(re),L=m(te,2),K=f(L),fe=f(K),gt=f(fe);gt.__click=[Mt,ke,A],p(fe);var Oe=m(fe,2),pt=f(Oe);pt.__click=[Wt,ke,A],p(Oe),p(K);var qe=m(K,2),_t=f(qe);_t.__click=[Vt,Me,A],p(qe),p(L),p(re),Et(2),Q(()=>{Ue(te,"src",e(A).data.navSrc),Ue(te,"alt",e(A).name)}),h(B,oe)}),p(H),p(D),Y("click",x,()=>_(ce,!1),!0),he(3,D,()=>be,()=>b),h(c,d)};R(Ae,c=>{e(ce)&&c(vt)})}var dt=m(Ae,2);{var ut=c=>{var d=la(),x=f(d),D=m(f(x),2);Nt(D,()=>e(S));var E=m(D,2),z=f(E);{var ee=B=>{var A=me(),oe=U(A);{var re=L=>{var K=Xt();h(L,K)},te=L=>{var K=ea();K.__click=[Zt,V],h(L,K)};R(oe,L=>{e(V)?L(re):L(te,!1)})}h(B,A)},H=B=>{var A=aa();A.__click=[ta,X,S],h(B,A)};R(z,B=>{e(X)?B(ee):B(H,!1)})}p(E),p(x),p(d),h(c,d)};R(dt,c=>{(e(X)||e(S))&&c(ut)})}Y("change",i,c=>c.target!=document.activeElement?Ye(ie(c)):{},!0),Y("change",q,c=>e(v).title=ie(c),!0),Y("change",j,c=>e(v).date=ie(c),!0),h(t,a)},ot=t=>{var a=ua(),l=f(a),n=f(l);{var i=r=>{var g=oa(),P=U(g);P.__click=[ia,Se];var I=m(P,2);I.__change=[sa,at],h(r,g)},s=r=>{var g=me(),P=U(g);{var I=y=>{var j=va(),G=m(U(j),2),pe=f(G);pe.__click=[ra,nt],p(G);var Z=m(G,2),_e=f(Z);_e.__click=[ca,lt],p(Z),h(y,j)},q=y=>{var j=da();h(y,j)};R(P,y=>{e(xe)?y(I):y(q,!1)})}h(r,g)};R(n,r=>{e(W)?r(s,!1):r(i)})}p(l),p(a),h(t,a)};R(it,t=>{e(we)?t(st):t(ot,!1)})}Re("innerWidth",t=>_(k,t,!0)),Re("innerHeight",t=>_(le,t,!0)),h(u,Te),Tt()}Pt(["click","change"]);export{xa as component,ya as universal};
