import"../chunks/DsnmJJEf.js";import{o as ut,s as Oe}from"../chunks/Drnj-hpf.js";import{h as ye,J as ae,T as pt,x as Q,c as qe,a1 as ft,at as _t,m as Ne,K as gt,O as mt,R as ht,P as wt,a0 as Fe,s as yt,au as bt,n as kt,o as St,ar as It,F as me,t as J,y as h,z as xt,u as _,v as C,B as n,q as k,G as B,A as m,w as g,C as f,D as Y,av as Pt}from"../chunks/Co3hCml5.js";import{i as R}from"../chunks/DPyqPMB2.js";import{b as je,e as Le,i as Re,s as $e,t as he,a as we}from"../chunks/CXvPUOk9.js";import{a as Dt,s as Ke}from"../chunks/83Z9ZpwJ.js";import{I as Ct}from"../chunks/CPz814e5.js";function Tt(p){ye&&ae(p)!==null&&pt(p)}function At(p,o,w=!1,I=!1,le=!1){var N=p,H="";Q(()=>{var $=ft;if(H===(H=o()??"")){ye&&qe();return}if($.nodes_start!==null&&(_t($.nodes_start,$.nodes_end),$.nodes_start=$.nodes_end=null),H!==""){if(ye){Ne.data;for(var T=qe(),ne=T;T!==null&&(T.nodeType!==gt||T.data!=="");)ne=T,T=mt(T);if(T===null)throw ht(),wt;Fe(Ne,ne),N=yt(T);return}var O=H+"";w?O=`<svg>${O}</svg>`:I&&(O=`<math>${O}</math>`);var F=bt(O);if((w||I)&&(F=ae(F)),Fe(ae(F),F.lastChild),w||I)for(;ae(F);)N.before(ae(F));else N.before(F)}})}const Et=async({fetch:p})=>({collections:await(await p("/collections/all.json")).json()}),ga=Object.freeze(Object.defineProperty({__proto__:null,load:Et},Symbol.toStringTag,{value:"Module"}));function Ue(p){return new Promise((o,w)=>{const I=document.createElement("script");I.src=p,document.body.appendChild(I),I.addEventListener("load",()=>o(I)),I.addEventListener("error",()=>w(I))})}var Ot=k("<option></option>"),qt=k('<span class="post-id svelte-d25vwp">-- Getting post ID --</span>'),Nt=k('<span class="post-id svelte-d25vwp"> </span>'),Ft=(p,o)=>_(o,!0),jt=(p,o)=>o(),Lt=k('<div class="overlay svelte-d25vwp"><div class="overlay svelte-d25vwp"></div> <div><textarea class="content-input svelte-d25vwp" id="contentTextArea" placeholder="Add post content..."></textarea> <div class="content-bottom svelte-d25vwp"><button class="add-button svelte-d25vwp">Upload All</button></div></div></div>'),Rt=(p,o)=>_(o,!0),$t=k("<div> </div>"),Kt=(p,o)=>o("chooseImages"),Ut=(p,o)=>o(p),Jt=(p,o,w)=>o(n(w),-1),Bt=(p,o,w)=>o(n(w),1),Gt=(p,o,w)=>o(n(w)),zt=k('<div class="image-preview-container svelte-d25vwp"><img class="image-preview svelte-d25vwp"/> <div class="overlay svelte-d25vwp"><div class="right-align svelte-d25vwp"><div class="svelte-d25vwp"><button class="image-preview-button svelte-d25vwp">↑</button></div> <div class="bottom-right svelte-d25vwp"><button class="image-preview-button svelte-d25vwp">↓</button></div></div> <div class="left-align svelte-d25vwp"><button class="image-preview-button red-button svelte-d25vwp">-</button></div></div></div> <div class="small-margins svelte-d25vwp"></div>',1),Ht=k('<div class="overlay svelte-d25vwp"></div> <div class="image-edit-popout svelte-d25vwp"><div class="small-margins svelte-d25vwp"><button class="add-button fill-width svelte-d25vwp">Add Images...</button> <input id="chooseImages" type="file" accept="image/*" multiple style="display:none;"/></div> <div class="small-margins bottom-line svelte-d25vwp"></div> <div class="small-margins svelte-d25vwp"></div></div>',1),Mt=k("<p>Cancelling...</p>"),Wt=(p,o)=>_(o,!0),Vt=k('<button class="add-button red-button svelte-d25vwp">Cancel</button>'),Yt=(p,o,w)=>{_(o,!1),_(w,"")},Qt=k('<button class="add-button svelte-d25vwp">Done</button>'),Xt=k('<div class="overlay-darken center-parent svelte-d25vwp"><div class="center-login svelte-d25vwp"><h3>Uploading...</h3> <!> <div class="small-padding svelte-d25vwp"><!></div></div></div>'),Zt=k('<!> <div class="header svelte-d25vwp"><input class="collection-input svelte-d25vwp" list="collectionList" placeholder="Collection"/> <datalist id="collectionList"></datalist> <!> <div class="svelte-d25vwp"><input class="title-input svelte-d25vwp" placeholder="Title"/></div> <div class="svelte-d25vwp"><input class="small-input svelte-d25vwp" placeholder="Date"/></div> <div class="svelte-d25vwp"><button class="add-button svelte-d25vwp">Edit Images...</button></div></div> <!> <!> <!>',1),ea=(p,o)=>o("chooseAuthKeyFile"),ta=(p,o)=>o(p),aa=k('<button class="add-button svelte-d25vwp">Load API Key</button> <input id="chooseAuthKeyFile" type="file" accept=".txt" multiple style="display:none;"/>',1),la=(p,o)=>o(),na=(p,o)=>o(),ia=k('<h1 class="title svelte-d25vwp">Login</h1> <div class="small-padding svelte-d25vwp"><button class="add-button svelte-d25vwp">Authenticate</button></div> <div class="small-padding svelte-d25vwp"><button class="add-button red-button svelte-d25vwp">Remove API Key</button></div>',1),sa=k('<h1 class="title svelte-d25vwp">Loading...</h1>'),ra=k('<div class="overlay-darken center-parent svelte-d25vwp"><div class="center-login svelte-d25vwp"><!></div></div>');function ma(p,o){St(o,!0);const w={duration:200,x:-100,opacity:0};let I=C(0),le=C(0),N=B(()=>n(I)<=n(le)),H=B(()=>n(I)/n(le)>=2),$=B(()=>n(N)?{duration:200,y:100,opactiy:0}:{duration:200,x:100,opacity:0}),T=B(()=>n(N)?"content-container-portrait":"content-container"),ne=B(()=>n(N)?"edge-container-portrait":"edge-container"),O=C(!1),F=B(()=>n(O)?n(N)?"expanded-portrait":n(H)?"expanded-ultrawide":"expanded":""),Je=B(()=>n(N)?"↑":"←"),de=C(!1),ce,M=C(""),be=C(!1),ke=C(!1),X=C(!1),W=C(!1),x=C(""),Be=C(!1),ve=C(!1),c=It({id:"",collection:"",date:"",title:"",content:"",contentParagraphs:[],images:[]});function Ge(e){let t=e.target;if(!(!t||!t.files))for(let a=0;a<t.files.length;++a){let l=t.files[a];const i=new FileReader;i.onload=function(){if(i.result){const s={data:i.result.toString(),name:l.name},r={name:l.name,data:{src:s.data,collageSrc:"",navSrc:""}};c.images.push(r),Xe(r)}},i.readAsDataURL(l)}}function ze(e){c.images=c.images.filter(t=>t!=e)}function Se(e,t){let a=c.images.findIndex(i=>i==e);if(a<0)return;let l=a+t;l>=c.images.length||c.images.splice(l,0,c.images.splice(a,1)[0])}function Ie(e){let t=document.getElementById(e);t&&t.click()}function ie(e){let t=e.target;return t?t.value:""}function He(e){c.content=e,c.contentParagraphs=e.split(`
`)}async function ue(e){const a=await(await fetch(e).then(l=>l.blob())).arrayBuffer();return new Uint8Array(a)}async function xe(e,t){let a=document.createElement("canvas"),l=a.getContext("2d");if(!l)return null;const i=t/(e.width/e.height);let s=Math.min(t/e.width,i/e.height),r=e.width*s,u=e.height*s;return a.width=r,a.height=u,l.drawImage(e,0,0,r,u),a.toDataURL("image/jpeg")}function Me(e,t){c.collection=e,Ve()}async function pe(e,t=!1){let a=e.split("/"),l="root";for(let i=0;i<a.length;++i){let s=a[i],r=`'${l}' in parents and name = '${s}' and mimeType = 'application/vnd.google-apps.folder' and trashed = false`,u=await gapi.client.request({path:`/drive/v3/files?q=${encodeURI(r)}`,method:"GET"});if(!u)return null;let P=JSON.parse(u.body);if(!P.files||P.files.length==0){if(t){let q=JSON.stringify({name:s,parents:[l],mimeType:"application/vnd.google-apps.folder"});if(!await gapi.client.request({path:"/drive/v3/files",method:"POST",body:q,headers:{"content-type":"application/json","content-length":q.length}}))return null;--i;continue}return null}l=P.files[0].id}return l}async function We(){let e=`BlogData/Posts/${c.collection}`,t=`${c.collection}-01`,a=await pe(e);if(!a)return t;let l=`'${a}' in parents and mimeType != 'application/vnd.google-apps.folder'`,i=await gapi.client.request({path:"/drive/v3/files",params:{q:l},method:"GET"});if(!i)return t;let s=JSON.parse(i.body);if(!s.files||s.files.length==0)return t;s.files.sort((y,j)=>y.name<j.name?-1:y.name>j.name?1:0);let u=s.files[s.files.length-1].name.split("."),S=u[u.length-2].match(/(?:\d+)(?!.*\d)/),q=S?S[0]:null;return q?`${c.collection}-${String(Number(q)+1).padStart(2,"0")}`:t}async function Pe(e){let t=e.split("/"),a=t.slice(0,-1).join("/"),l=t[t.length-1],i=await pe(a);if(!i)return null;let s=`'${i}' in parents and name = '${l}'`,r=await gapi.client.request({path:"/drive/v3/files",params:{q:s},method:"GET"});if(!r)return null;let u=JSON.parse(r.body);return!u.files||u.files.length==0?null:u.files[0].id}async function Ve(){_(ve,!0);let e=await We();c.id=e,_(ve,!1)}async function Ye(){_(W,!1),_(X,!0),_(x,"");let e=!0,t=JSON.parse(JSON.stringify(c));t.images=new Array(c.images.length),t.contentParagraphs=void 0;for(let l=0;l<c.images.length&&!n(W);++l){let i=c.images[l];_(x,n(x)+`Uploading images for '${i.name}'... `);let s=await Qe(i);if(e=!!s,_(x,n(x)+((e?"Success":"Failed")+"<br>")),!e||!s)break;t.images[l]=s}let a=`BlogData/Posts/${t.collection}/${t.id}.json`;if(e&&!n(W)){let l=JSON.stringify(t),i=new TextEncoder;_(x,n(x)+`Uploading '${a}'... `);let s=await se(a,i.encode(l));_(x,n(x)+(s?"Success":"Failed"))}n(W)&&_(x,n(x)+"Cancelled"),_(X,!1)}async function Qe(e){let t={src:"",collageSrc:"",navSrc:""},a=e.name.split("."),l=a[0],i=await ue(e.data.src),s=`BlogData/Photos/${c.collection}/${e.name}`,r=await se(s,i);if(r)t.src=`https://lh3.googleusercontent.com/d/${r}?authuser=0`;else return null;let u=l+"_w1000."+a[1];if(s=`BlogData/Photos/${c.collection}/${u}`,i=await ue(e.data.collageSrc),r=await se(s,i),r)t.collageSrc=`https://lh3.googleusercontent.com/d/${r}?authuser=0`;else return null;if(u=l+"_w200."+a[1],s=`BlogData/Photos/${c.collection}/${u}`,i=await ue(e.data.navSrc),r=await se(s,i),r)t.navSrc=`https://lh3.googleusercontent.com/d/${r}?authuser=0`;else return null;return t}async function Xe(e){const t={collageSrc:1e3,navSrc:200};let a=new Image,l=new Promise((r,u)=>{a.onload=()=>{r(a)},a.onerror=()=>{u()}});a.src=e.data.src,await l;let i=await xe(a,t.collageSrc),s=c.images.find(r=>r.name==e.name);i&&s&&(s.data.collageSrc=i),i=await xe(a,t.navSrc),i&&s&&(s.data.navSrc=i)}async function se(e,t){let a=await Pe(e);if(a)return a;let l=e.split("/"),i=l[l.length-1],s=l.slice(0,-1).join("/"),r=await pe(s,!0),P=JSON.stringify({name:i,parents:[r]}),S=await gapi.client.request({path:"/upload/drive/v3/files?uploadType=resumable",method:"POST",body:P,headers:{"content-type":"application/json","content-length":P.length,"x-upload-content-length":t.byteLength}});if(!S||!S.headers)return null;let y=JSON.parse(JSON.stringify(S.headers)).location;try{await fetch(y,{method:"PUT",body:t,headers:{"content-length":t.byteLength.toString()}})}catch{}return a=await Pe(e),a}async function De(){await gapi.client.init({apiKey:n(M)}),ce=google.accounts.oauth2.initTokenClient({client_id:"953825518423-opf6ljfsqvslodfru7ugocm5ps5rgacp.apps.googleusercontent.com",scope:"https://www.googleapis.com/auth/drive.file",callback:async e=>{if(e.error!==void 0)throw alert(`Failed to authenticate: ${e}`),e;_(ke,!0)}}),_(be,!0)}function Ze(e){let t=e.target;if(!t||!t.files||t.files.length==0)return;let a=t.files[0];const l=new FileReader;l.onload=function(){l.result&&(_(M,l.result.toString(),!0),localStorage.setItem("apiKey",n(M)),gapi.load("client",De))},l.readAsText(a)}function et(){localStorage.removeItem("apiKey"),_(M,"")}function tt(){gapi.client.getToken()===null?ce.requestAccessToken({prompt:"consent"}):ce.requestAccessToken({prompt:""})}ut(async()=>{await Ue("https://apis.google.com/js/api.js"),await Ue("https://accounts.google.com/gsi/client");let e=localStorage.getItem("apiKey");e&&(_(M,e,!0),gapi.load("client",De))});var Ce=me(),at=J(Ce);{var lt=e=>{var t=Zt(),a=J(t);{let d=B(()=>c.images.map(v=>v.data));Ct(a,{get imagesData(){return n(d)}})}var l=m(a,2),i=g(l),s=m(i,2);Le(s,21,()=>o.data.collections,Re,(d,v)=>{var b=Ot(),D={};Q(()=>{D!==(D=n(v).id)&&(b.value=(b.__value=n(v).id)??"")}),h(d,b)}),f(s);var r=m(s,2);{var u=d=>{var v=qt();h(d,v)},P=d=>{var v=Nt(),b=g(v,!0);f(v),Q(()=>Oe(b,c.id)),h(d,v)};R(r,d=>{n(ve)?d(u):d(P,!1)})}var S=m(r,2),q=g(S);f(S);var y=m(S,2),j=g(y);f(y);var V=m(y,2),fe=g(V);fe.__click=[Ft,de],f(V),f(l);var Z=m(l,2);{var _e=d=>{var v=Lt(),b=g(v),D=m(b,2),A=g(D);Tt(A);var G=m(A,2),ee=g(G);ee.__click=[jt,Ye],f(G),f(D),f(v),Q(()=>{$e(D,1,`${n(T)??""} ${n(F)??""}`,"svelte-d25vwp"),Dt(A,c.content)}),Y("click",b,()=>_(O,!1),!0),Y("change",A,z=>{_(Be,z.target==document.activeElement),He(ie(z))},!0),he(3,D,()=>we,()=>n($)),h(d,v)},it=d=>{var v=$t();v.__click=[Rt,O];var b=g(v,!0);f(v),Q(()=>{$e(v,1,n(ne),"svelte-d25vwp"),Oe(b,n(Je))}),he(3,v,()=>we,()=>n($)),h(d,v)};R(Z,d=>{n(O)?d(_e):d(it,!1)})}var Te=m(Z,2);{var st=d=>{var v=Ht(),b=J(v),D=m(b,2),A=g(D),G=g(A);G.__click=[Kt,Ie];var ee=m(G,2);ee.__change=[Ut,Ge],f(A);var z=m(A,4);Le(z,21,()=>c.images,Re,(K,E)=>{var re=zt(),oe=J(re),te=g(oe),L=m(te,2),U=g(L),ge=g(U),dt=g(ge);dt.__click=[Jt,Se,E],f(ge);var Ae=m(ge,2),ct=g(Ae);ct.__click=[Bt,Se,E],f(Ae),f(U);var Ee=m(U,2),vt=g(Ee);vt.__click=[Gt,ze,E],f(Ee),f(L),f(oe),Pt(2),Q(()=>{Ke(te,"src",n(E).data.navSrc),Ke(te,"alt",n(E).name)}),h(K,re)}),f(z),f(D),Y("click",b,()=>_(de,!1),!0),he(3,D,()=>we,()=>w),h(d,v)};R(Te,d=>{n(de)&&d(st)})}var rt=m(Te,2);{var ot=d=>{var v=Xt(),b=g(v),D=m(g(b),2);At(D,()=>n(x));var A=m(D,2),G=g(A);{var ee=K=>{var E=me(),re=J(E);{var oe=L=>{var U=Mt();h(L,U)},te=L=>{var U=Vt();U.__click=[Wt,W],h(L,U)};R(re,L=>{n(W)?L(oe):L(te,!1)})}h(K,E)},z=K=>{var E=Qt();E.__click=[Yt,X,x],h(K,E)};R(G,K=>{n(X)?K(ee):K(z,!1)})}f(A),f(b),f(v),h(d,v)};R(rt,d=>{(n(X)||n(x))&&d(ot)})}Y("change",i,d=>d.target!=document.activeElement?Me(ie(d)):{},!0),Y("change",q,d=>c.title=ie(d),!0),Y("change",j,d=>c.date=ie(d),!0),h(e,t)},nt=e=>{var t=ra(),a=g(t),l=g(a);{var i=r=>{var u=aa(),P=J(u);P.__click=[ea,Ie];var S=m(P,2);S.__change=[ta,Ze],h(r,u)},s=r=>{var u=me(),P=J(u);{var S=y=>{var j=ia(),V=m(J(j),2),fe=g(V);fe.__click=[la,tt],f(V);var Z=m(V,2),_e=g(Z);_e.__click=[na,et],f(Z),h(y,j)},q=y=>{var j=sa();h(y,j)};R(P,y=>{n(be)?y(S):y(q,!1)})}h(r,u)};R(l,r=>{n(M)?r(s,!1):r(i)})}f(a),f(t),h(e,t)};R(at,e=>{n(ke)?e(lt):e(nt,!1)})}je("innerWidth",e=>_(I,e,!0)),je("innerHeight",e=>_(le,e,!0)),h(p,Ce),xt()}kt(["click","change"]);export{ma as component,ga as universal};
