import"../chunks/DsnmJJEf.js";import{o as mt,s as Re}from"../chunks/BWE3rs_R.js";import{v as Y,h as qe,a as Fe,a2 as ht,ar as yt,k as Be,O as bt,Q as xt,T as wt,R as kt,a1 as Le,s as St,as as It,C as ve,l as Pt,m as Dt,t as T,aj as Tt,J as ye,o as U,w as b,x as Ct,q as _,z as t,n as S,K as J,y as h,u as f,A as p,B as V,at as Et}from"../chunks/DqVZNpwN.js";import{i as F}from"../chunks/CMLcb2m1.js";import{b as Ke,e as Ue,i as Je,s as Ge,t as be,a as xe}from"../chunks/BHdDEesX.js";import{b as At,a as Ot,s as ze}from"../chunks/Duc2o9yF.js";import{I as Nt}from"../chunks/DBrIpZCh.js";function $t(u,s,x=!1,I=!1,ie=!1){var $=u,M="";Y(()=>{var B=ht;if(M===(M=s()??"")){qe&&Fe();return}if(B.nodes_start!==null&&(yt(B.nodes_start,B.nodes_end),B.nodes_start=B.nodes_end=null),M!==""){if(qe){Be.data;for(var C=Fe(),se=C;C!==null&&(C.nodeType!==bt||C.data!=="");)se=C,C=xt(C);if(C===null)throw wt(),kt;Le(Be,se),$=St(C);return}var N=M+"";x?N=`<svg>${N}</svg>`:I&&(N=`<math>${N}</math>`);var j=It(N);if((x||I)&&(j=ve(j)),Le(ve(j),j.lastChild),x||I)for(;ve(j);)$.before(ve(j));else $.before(j)}})}const jt=async({fetch:u})=>({collections:await(await u("/collections/all.json")).json()}),xa=Object.freeze(Object.defineProperty({__proto__:null,load:jt},Symbol.toStringTag,{value:"Module"}));function He(u){return new Promise((s,x)=>{const I=document.createElement("script");I.src=u,document.body.appendChild(I),I.addEventListener("load",()=>s(I)),I.addEventListener("error",()=>x(I))})}var Rt=(u,s,x)=>!u.inputType||u.inputType=="insertReplacementText"?s(x(u),!0):{},qt=S("<option></option>"),Ft=S('<span class="post-id svelte-5xvg81">-- Getting post ID --</span>'),Bt=S('<span class="post-id svelte-5xvg81"> </span>'),Lt=(u,s)=>_(s,!0),Kt=(u,s)=>s(),Ut=(u,s)=>s(),Jt=S('<div class="overlay svelte-5xvg81"><div class="overlay svelte-5xvg81"></div> <div><textarea class="content-input svelte-5xvg81" id="contentTextArea" placeholder="Add post content..."></textarea> <div class="content-bottom svelte-5xvg81"><button class="add-button svelte-5xvg81">Upload All</button></div></div></div>'),Gt=(u,s)=>_(s,!0),zt=S("<div> </div>"),Ht=(u,s)=>s("chooseImages"),Mt=(u,s)=>s(u),Wt=(u,s,x)=>s(t(x),-1),Qt=(u,s,x)=>s(t(x),1),Vt=(u,s,x)=>s(t(x)),Yt=S('<div class="image-preview-container svelte-5xvg81"><img class="image-preview svelte-5xvg81"/> <div class="overlay svelte-5xvg81"><div class="right-align svelte-5xvg81"><div class="svelte-5xvg81"><button class="image-preview-button svelte-5xvg81">↑</button></div> <div class="bottom-right svelte-5xvg81"><button class="image-preview-button svelte-5xvg81">↓</button></div></div> <div class="left-align svelte-5xvg81"><button class="image-preview-button red-button svelte-5xvg81">-</button></div></div></div> <div class="small-margins svelte-5xvg81"></div>',1),Xt=S('<div class="overlay svelte-5xvg81"></div> <div class="image-edit-popout svelte-5xvg81"><div class="small-margins svelte-5xvg81"><button class="add-button fill-width svelte-5xvg81">Add Images...</button> <input id="chooseImages" type="file" accept="image/*" multiple style="display:none;"/></div> <div class="small-margins bottom-line svelte-5xvg81"></div> <div class="small-margins svelte-5xvg81"></div></div>',1),Zt=S("<p>Cancelling...</p>"),ea=(u,s)=>_(s,!0),ta=S('<button class="add-button red-button svelte-5xvg81">Cancel</button>'),aa=(u,s,x)=>{_(s,!1),_(x,"")},la=S('<button class="add-button svelte-5xvg81">Done</button>'),na=S('<div class="overlay-darken center-parent svelte-5xvg81"><div class="center-login svelte-5xvg81"><h3>Uploading...</h3> <!> <div class="small-padding svelte-5xvg81"><!></div></div></div>'),ia=S('<!> <div class="header svelte-5xvg81"><input class="collection-input svelte-5xvg81" id="inputCollection" list="collectionList" placeholder="Collection"/> <datalist id="collectionList"></datalist> <!> <div class="svelte-5xvg81"><input class="title-input svelte-5xvg81" id="inputTitle" placeholder="Title" size="35"/></div> <div class="svelte-5xvg81"><input class="small-input svelte-5xvg81" id="inputDate" placeholder="Date"/></div> <div class="svelte-5xvg81"><button class="add-button svelte-5xvg81">Edit Images...</button></div> <div class="small-vertical-padding svelte-5xvg81"><button class="add-button red-button svelte-5xvg81">Clear Post Data</button></div></div> <!> <!> <!>',1),sa=(u,s)=>s("chooseAuthKeyFile"),oa=(u,s)=>s(u),ra=S('<button class="add-button svelte-5xvg81">Load API Key</button> <input id="chooseAuthKeyFile" type="file" accept=".txt" multiple style="display:none;"/>',1),ca=(u,s)=>s(),va=(u,s)=>s(),da=S('<h1 class="title svelte-5xvg81">Login</h1> <div class="small-padding svelte-5xvg81"><button class="add-button svelte-5xvg81">Authenticate</button></div> <div class="small-padding svelte-5xvg81"><button class="add-button red-button svelte-5xvg81">Remove API Key</button></div>',1),ua=S('<h1 class="title svelte-5xvg81">Loading...</h1>'),ga=S('<div class="overlay-darken center-parent svelte-5xvg81"><div class="center-login svelte-5xvg81"><!></div></div>');function wa(u,s){Dt(s,!0);const x={duration:200,x:-100,opacity:0};let I=T(0),ie=T(0),$=J(()=>t(I)<=t(ie)),M=J(()=>t(I)/t(ie)>=2),B=J(()=>t($)?{duration:200,y:100,opactiy:0}:{duration:200,x:100,opacity:0}),C=J(()=>t($)?"content-container-portrait":"content-container"),se=J(()=>t($)?"edge-container-portrait":"edge-container"),N=T(!1),j=J(()=>t(N)?t($)?"expanded-portrait":t(M)?"expanded-ultrawide":"expanded":""),Me=J(()=>t($)?"↑":"←"),de=T(!1),ue,W=T(""),we=T(!1),ke=T(!1),X=T(!1),Q=T(!1),P=T(""),We=T(!1),ge=T(!1),Se={id:"",collection:"",date:"",title:"",content:"",contentParagraphs:[],images:[]},d=T(Tt(Se));function Qe(e){let a=e.target;if(!(!a||!a.files))for(let l=0;l<a.files.length;++l){let n=a.files[l];const i=new FileReader;i.onload=function(){if(i.result){const o={data:i.result.toString(),name:n.name},r={name:n.name,data:{src:o.data,collageSrc:"",navSrc:""}};t(d).images.push(r),lt(r)}},i.readAsDataURL(n)}}function Ve(e){t(d).images=t(d).images.filter(a=>a!=e)}function Ie(e,a){let l=t(d).images.findIndex(i=>i==e);if(l<0)return;let n=l+a;n>=t(d).images.length||t(d).images.splice(n,0,t(d).images.splice(l,1)[0])}function Pe(e){let a=document.getElementById(e);a&&a.click()}function Z(e){let a=e.target;return a?a.value:""}function Ye(e){t(d).content=e,t(d).contentParagraphs=e.split(`
`)}function Xe(){_(d,Se,!0);let e=document.getElementById("inputTitle");e.value="";let a=document.getElementById("inputDate");a.value="";let l=document.getElementById("inputCollection");l.value="";let n=document.getElementById("contentTextArea");n.value=""}async function pe(e){const l=await(await fetch(e).then(n=>n.blob())).arrayBuffer();return new Uint8Array(l)}async function De(e,a){let l=document.createElement("canvas"),n=l.getContext("2d");if(!n)return null;const i=a/(e.width/e.height);let o=Math.min(a/e.width,i/e.height),r=e.width*o,c=e.height*o;return l.width=r,l.height=c,n.drawImage(e,0,0,r,c),l.toDataURL("image/jpeg")}function Te(e,a){t(d).collection=e,a&&et()}async function ee(e){try{return await gapi.client.request(e)}catch(a){a.status&&(a.status==404||a.status==401)&&_e()}return null}async function te(e,a=!1){let l=e.split("/"),n="root";for(let i=0;i<l.length;++i){let o=l[i],r=`'${n}' in parents and name = '${o}' and mimeType = 'application/vnd.google-apps.folder' and trashed = false`,c=await ee({path:`/drive/v3/files?q=${encodeURI(r)}`,method:"GET"});if(!c)return null;let m=JSON.parse(c.body);if(!m.files||m.files.length==0){if(a){let E=JSON.stringify({name:o,parents:[n],mimeType:"application/vnd.google-apps.folder"});if(!await ee({path:"/drive/v3/files",method:"POST",body:E,headers:{"content-type":"application/json","content-length":E.length}}))return null;--i;continue}return null}n=m.files[0].id}return n}async function Ze(){let e=`BlogData/Posts/${t(d).collection}`,a=`${t(d).collection}-01`,l=await te(e);if(!l)return a;let n=`'${l}' in parents and mimeType != 'application/vnd.google-apps.folder'`,i=await ee({path:"/drive/v3/files",params:{q:n},method:"GET"});if(!i)return a;let o=JSON.parse(i.body);if(!o.files||o.files.length==0)return a;o.files.sort((y,R)=>y.name<R.name?-1:y.name>R.name?1:0);let c=o.files[o.files.length-1].name.split("."),w=c[c.length-2].match(/(?:\d+)(?!.*\d)/),E=w?w[0]:null;return E?`${t(d).collection}-${String(Number(E)+1).padStart(2,"0")}`:a}async function Ce(e){let a=e.split("/"),l=a.slice(0,-1).join("/"),n=a[a.length-1],i=await te(l);if(!i)return null;let o=`'${i}' in parents and name = '${n}'`,r=await ee({path:"/drive/v3/files",params:{q:o},method:"GET"});if(!r)return null;let c=JSON.parse(r.body);return!c.files||c.files.length==0?null:c.files[0].id}async function et(){_(ge,!0);let e=await Ze();t(d).id=e,_(ge,!1)}async function tt(){_(Q,!1),_(X,!0),_(P,"");let e=!0,a=JSON.parse(JSON.stringify(t(d)));a.images=new Array(t(d).images.length),a.contentParagraphs=void 0;let l=`BlogData/Photos/${a.collection}`,n=await te(l);for(let o=0;o<t(d).images.length&&!t(Q);++o){let r=t(d).images[o];_(P,t(P)+`Uploading images for '${r.name}'... `);let c=await at(r,n);if(e=!!c,_(P,t(P)+((e?"Success":"Failed")+"<br>")),!e||!c)break;a.images[o]=c}l=`BlogData/Posts/${a.collection}`;let i=`${l}/${a.id}.json`;if(e&&!t(Q)){let o=JSON.stringify(a),r=new TextEncoder;_(P,t(P)+`Uploading '${i}'... `);let c=await oe(i,null,r.encode(o));_(P,t(P)+(c?"Success":"Failed"))}t(Q)&&_(P,t(P)+"Cancelled"),_(X,!1)}async function at(e,a){let l={src:"",collageSrc:"",navSrc:""},n=e.name.split("."),i=n[0],o=`BlogData/Photos/${t(d).collection}`;a||(a=await te(o,!0));let r=await pe(e.data.src),c=`${o}/${e.name}`,m=await oe(c,a,r);if(m)l.src=`https://lh3.googleusercontent.com/d/${m}?authuser=0`;else return null;let w=i+"_w1000."+n[1];if(c=`BlogData/Photos/${t(d).collection}/${w}`,r=await pe(e.data.collageSrc),m=await oe(c,a,r),m)l.collageSrc=`https://lh3.googleusercontent.com/d/${m}?authuser=0`;else return null;if(w=i+"_w200."+n[1],c=`BlogData/Photos/${t(d).collection}/${w}`,r=await pe(e.data.navSrc),m=await oe(c,a,r),m)l.navSrc=`https://lh3.googleusercontent.com/d/${m}?authuser=0`;else return null;return l}async function lt(e){const a={collageSrc:1e3,navSrc:200};let l=new Image,n=new Promise((r,c)=>{l.onload=()=>{r(l)},l.onerror=()=>{c()}});l.src=e.data.src,await n;let i=await De(l,a.collageSrc),o=t(d).images.find(r=>r.name==e.name);i&&o&&(o.data.collageSrc=i),i=await De(l,a.navSrc),i&&o&&(o.data.navSrc=i)}async function oe(e,a,l){let n=await Ce(e);if(n)return n;let i=e.split("/"),o=i[i.length-1];if(!a){let y=i.slice(0,-1).join("/");a=await te(y,!0)}let c=JSON.stringify({name:o,parents:[a]}),m=await ee({path:"/upload/drive/v3/files?uploadType=resumable",method:"POST",body:c,headers:{"content-type":"application/json","content-length":c.length,"x-upload-content-length":l.byteLength}});if(!m||!m.headers)return null;let E=JSON.parse(JSON.stringify(m.headers)).location;try{let y=await fetch(E,{method:"PUT",body:l,headers:{"content-length":l.byteLength.toString()}});if(!y||!y.ok)return _e(),null}catch{}return n=await Ce(e),n}async function Ee(){await gapi.client.init({apiKey:t(W)}),ue=google.accounts.oauth2.initTokenClient({client_id:"953825518423-opf6ljfsqvslodfru7ugocm5ps5rgacp.apps.googleusercontent.com",scope:"https://www.googleapis.com/auth/drive.file",callback:async e=>{if(e.error!==void 0)throw alert(`Failed to authenticate: ${e}`),e;_(ke,!0)}}),_(we,!0)}function nt(e){let a=e.target;if(!a||!a.files||a.files.length==0)return;let l=a.files[0];const n=new FileReader;n.onload=function(){n.result&&(_(W,n.result.toString(),!0),localStorage.setItem("apiKey",t(W)),gapi.load("client",Ee))},n.readAsText(l)}function it(){localStorage.removeItem("apiKey"),_(W,"")}function _e(){gapi.client.getToken()===null?ue.requestAccessToken({prompt:"consent"}):ue.requestAccessToken({prompt:""})}mt(async()=>{await He("https://apis.google.com/js/api.js"),await He("https://accounts.google.com/gsi/client");let e=localStorage.getItem("apiKey");e&&(_(W,e,!0),gapi.load("client",Ee))});var Ae=ye(),st=U(Ae);{var ot=e=>{var a=ia(),l=U(a);{let v=J(()=>t(d).images.map(g=>g.data));Nt(l,{get imagesData(){return t(v)}})}var n=h(l,2),i=f(n);i.__input=[Rt,Te,Z];var o=h(i,2);Ue(o,21,()=>s.data.collections,Je,(v,g)=>{var k=qt(),D={};Y(()=>{D!==(D=t(g).id)&&(k.value=(k.__value=t(g).id)??"")}),b(v,k)}),p(o);var r=h(o,2);{var c=v=>{var g=Ft();b(v,g)},m=v=>{var g=Bt(),k=f(g,!0);p(g),Y(()=>Re(k,t(d).id)),b(v,g)};F(r,v=>{t(ge)?v(c):v(m,!1)})}var w=h(r,2),E=f(w);p(w);var y=h(w,2),R=f(y);p(y);var G=h(y,2),fe=f(G);fe.__click=[Lt,de],p(G);var ae=h(G,2),me=f(ae);me.__click=[Kt,Xe],p(ae),p(n);var Oe=h(n,2);{var ct=v=>{var g=Jt(),k=f(g),D=h(k,2),A=f(D);At(A);var z=h(A,2),le=f(z);le.__click=[Ut,tt],p(z),p(D),p(g),Y(()=>{Ge(D,1,`${t(C)??""} ${t(j)??""}`,"svelte-5xvg81"),Ot(A,t(d).content)}),V("click",k,()=>_(N,!1),!0),V("change",A,H=>{_(We,H.target==document.activeElement),Ye(Z(H))},!0),be(3,D,()=>xe,()=>t(B)),b(v,g)},vt=v=>{var g=zt();g.__click=[Gt,N];var k=f(g,!0);p(g),Y(()=>{Ge(g,1,t(se),"svelte-5xvg81"),Re(k,t(Me))}),be(3,g,()=>xe,()=>t(B)),b(v,g)};F(Oe,v=>{t(N)?v(ct):v(vt,!1)})}var Ne=h(Oe,2);{var dt=v=>{var g=Xt(),k=U(g),D=h(k,2),A=f(D),z=f(A);z.__click=[Ht,Pe];var le=h(z,2);le.__change=[Mt,Qe],p(A);var H=h(A,4);Ue(H,21,()=>t(d).images,Je,(L,O)=>{var re=Yt(),ce=U(re),ne=f(ce),q=h(ne,2),K=f(q),he=f(K),pt=f(he);pt.__click=[Wt,Ie,O],p(he);var $e=h(he,2),_t=f($e);_t.__click=[Qt,Ie,O],p($e),p(K);var je=h(K,2),ft=f(je);ft.__click=[Vt,Ve,O],p(je),p(q),p(ce),Et(2),Y(()=>{ze(ne,"src",t(O).data.navSrc),ze(ne,"alt",t(O).name)}),b(L,re)}),p(H),p(D),V("click",k,()=>_(de,!1),!0),be(3,D,()=>xe,()=>x),b(v,g)};F(Ne,v=>{t(de)&&v(dt)})}var ut=h(Ne,2);{var gt=v=>{var g=na(),k=f(g),D=h(f(k),2);$t(D,()=>t(P));var A=h(D,2),z=f(A);{var le=L=>{var O=ye(),re=U(O);{var ce=q=>{var K=Zt();b(q,K)},ne=q=>{var K=ta();K.__click=[ea,Q],b(q,K)};F(re,q=>{t(Q)?q(ce):q(ne,!1)})}b(L,O)},H=L=>{var O=la();O.__click=[aa,X,P],b(L,O)};F(z,L=>{t(X)?L(le):L(H,!1)})}p(A),p(k),p(g),b(v,g)};F(ut,v=>{(t(X)||t(P))&&v(gt)})}V("change",i,v=>v.target!=document.activeElement?Te(Z(v),!0):{},!0),V("change",E,v=>t(d).title=Z(v),!0),V("change",R,v=>t(d).date=Z(v),!0),b(e,a)},rt=e=>{var a=ga(),l=f(a),n=f(l);{var i=r=>{var c=ra(),m=U(c);m.__click=[sa,Pe];var w=h(m,2);w.__change=[oa,nt],b(r,c)},o=r=>{var c=ye(),m=U(c);{var w=y=>{var R=da(),G=h(U(R),2),fe=f(G);fe.__click=[ca,_e],p(G);var ae=h(G,2),me=f(ae);me.__click=[va,it],p(ae),b(y,R)},E=y=>{var R=ua();b(y,R)};F(m,y=>{t(we)?y(w):y(E,!1)})}b(r,c)};F(n,r=>{t(W)?r(o,!1):r(i)})}p(l),p(a),b(e,a)};F(st,e=>{t(ke)?e(ot):e(rt,!1)})}Ke("innerWidth",e=>_(I,e,!0)),Ke("innerHeight",e=>_(ie,e,!0)),b(u,Ae),Ct()}Pt(["input","click","change"]);export{wa as component,xa as universal};
