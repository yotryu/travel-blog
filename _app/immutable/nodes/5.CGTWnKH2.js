import"../chunks/DsnmJJEf.js";import{o as ft,s as qe}from"../chunks/BWE3rs_R.js";import{v as Y,h as Ne,a as je,a2 as mt,ar as ht,k as Fe,O as bt,Q as yt,T as xt,R as wt,a1 as Le,s as kt,as as It,C as re,l as St,m as Pt,t as C,aj as Dt,J as me,o as U,w as h,x as Ct,q as p,z as e,n as w,K as J,y as m,u as _,A as g,B as V,at as Tt}from"../chunks/DqVZNpwN.js";import{i as R}from"../chunks/CMLcb2m1.js";import{b as Re,e as $e,i as Be,s as Ke,t as he,a as be}from"../chunks/BHdDEesX.js";import{b as Et,a as At,s as Ue}from"../chunks/Duc2o9yF.js";import{I as Ot}from"../chunks/DBrIpZCh.js";function qt(f,o,b=!1,I=!1,ae=!1){var N=f,M="";Y(()=>{var $=mt;if(M===(M=o()??"")){Ne&&je();return}if($.nodes_start!==null&&(ht($.nodes_start,$.nodes_end),$.nodes_start=$.nodes_end=null),M!==""){if(Ne){Fe.data;for(var T=je(),le=T;T!==null&&(T.nodeType!==bt||T.data!=="");)le=T,T=yt(T);if(T===null)throw xt(),wt;Le(Fe,le),N=kt(T);return}var O=M+"";b?O=`<svg>${O}</svg>`:I&&(O=`<math>${O}</math>`);var j=It(O);if((b||I)&&(j=re(j)),Le(re(j),j.lastChild),b||I)for(;re(j);)N.before(re(j));else N.before(j)}})}const Nt=async({fetch:f})=>({collections:await(await f("/collections/all.json")).json()}),ba=Object.freeze(Object.defineProperty({__proto__:null,load:Nt},Symbol.toStringTag,{value:"Module"}));function Je(f){return new Promise((o,b)=>{const I=document.createElement("script");I.src=f,document.body.appendChild(I),I.addEventListener("load",()=>o(I)),I.addEventListener("error",()=>b(I))})}var jt=w("<option></option>"),Ft=w('<span class="post-id svelte-5xvg81">-- Getting post ID --</span>'),Lt=w('<span class="post-id svelte-5xvg81"> </span>'),Rt=(f,o)=>p(o,!0),$t=(f,o)=>o(),Bt=(f,o)=>o(),Kt=w('<div class="overlay svelte-5xvg81"><div class="overlay svelte-5xvg81"></div> <div><textarea class="content-input svelte-5xvg81" id="contentTextArea" placeholder="Add post content..."></textarea> <div class="content-bottom svelte-5xvg81"><button class="add-button svelte-5xvg81">Upload All</button></div></div></div>'),Ut=(f,o)=>p(o,!0),Jt=w("<div> </div>"),Gt=(f,o)=>o("chooseImages"),zt=(f,o)=>o(f),Ht=(f,o,b)=>o(e(b),-1),Mt=(f,o,b)=>o(e(b),1),Wt=(f,o,b)=>o(e(b)),Qt=w('<div class="image-preview-container svelte-5xvg81"><img class="image-preview svelte-5xvg81"/> <div class="overlay svelte-5xvg81"><div class="right-align svelte-5xvg81"><div class="svelte-5xvg81"><button class="image-preview-button svelte-5xvg81">↑</button></div> <div class="bottom-right svelte-5xvg81"><button class="image-preview-button svelte-5xvg81">↓</button></div></div> <div class="left-align svelte-5xvg81"><button class="image-preview-button red-button svelte-5xvg81">-</button></div></div></div> <div class="small-margins svelte-5xvg81"></div>',1),Vt=w('<div class="overlay svelte-5xvg81"></div> <div class="image-edit-popout svelte-5xvg81"><div class="small-margins svelte-5xvg81"><button class="add-button fill-width svelte-5xvg81">Add Images...</button> <input id="chooseImages" type="file" accept="image/*" multiple style="display:none;"/></div> <div class="small-margins bottom-line svelte-5xvg81"></div> <div class="small-margins svelte-5xvg81"></div></div>',1),Yt=w("<p>Cancelling...</p>"),Xt=(f,o)=>p(o,!0),Zt=w('<button class="add-button red-button svelte-5xvg81">Cancel</button>'),ea=(f,o,b)=>{p(o,!1),p(b,"")},ta=w('<button class="add-button svelte-5xvg81">Done</button>'),aa=w('<div class="overlay-darken center-parent svelte-5xvg81"><div class="center-login svelte-5xvg81"><h3>Uploading...</h3> <!> <div class="small-padding svelte-5xvg81"><!></div></div></div>'),la=w('<!> <div class="header svelte-5xvg81"><input class="collection-input svelte-5xvg81" id="inputCollection" list="collectionList" placeholder="Collection"/> <datalist id="collectionList"></datalist> <!> <div class="svelte-5xvg81"><input class="title-input svelte-5xvg81" id="inputTitle" placeholder="Title" size="35"/></div> <div class="svelte-5xvg81"><input class="small-input svelte-5xvg81" id="inputDate" placeholder="Date"/></div> <div class="svelte-5xvg81"><button class="add-button svelte-5xvg81">Edit Images...</button></div> <div class="small-vertical-padding svelte-5xvg81"><button class="add-button red-button svelte-5xvg81">Clear Post Data</button></div></div> <!> <!> <!>',1),na=(f,o)=>o("chooseAuthKeyFile"),ia=(f,o)=>o(f),sa=w('<button class="add-button svelte-5xvg81">Load API Key</button> <input id="chooseAuthKeyFile" type="file" accept=".txt" multiple style="display:none;"/>',1),oa=(f,o)=>o(),ra=(f,o)=>o(),ca=w('<h1 class="title svelte-5xvg81">Login</h1> <div class="small-padding svelte-5xvg81"><button class="add-button svelte-5xvg81">Authenticate</button></div> <div class="small-padding svelte-5xvg81"><button class="add-button red-button svelte-5xvg81">Remove API Key</button></div>',1),da=w('<h1 class="title svelte-5xvg81">Loading...</h1>'),va=w('<div class="overlay-darken center-parent svelte-5xvg81"><div class="center-login svelte-5xvg81"><!></div></div>');function ya(f,o){Pt(o,!0);const b={duration:200,x:-100,opacity:0};let I=C(0),ae=C(0),N=J(()=>e(I)<=e(ae)),M=J(()=>e(I)/e(ae)>=2),$=J(()=>e(N)?{duration:200,y:100,opactiy:0}:{duration:200,x:100,opacity:0}),T=J(()=>e(N)?"content-container-portrait":"content-container"),le=J(()=>e(N)?"edge-container-portrait":"edge-container"),O=C(!1),j=J(()=>e(O)?e(N)?"expanded-portrait":e(M)?"expanded-ultrawide":"expanded":""),Ge=J(()=>e(N)?"↑":"←"),ce=C(!1),de,W=C(""),ye=C(!1),xe=C(!1),X=C(!1),Q=C(!1),S=C(""),ze=C(!1),ve=C(!1),we={id:"",collection:"",date:"",title:"",content:"",contentParagraphs:[],images:[]},d=C(Dt(we));function He(t){let a=t.target;if(!(!a||!a.files))for(let l=0;l<a.files.length;++l){let n=a.files[l];const i=new FileReader;i.onload=function(){if(i.result){const s={data:i.result.toString(),name:n.name},r={name:n.name,data:{src:s.data,collageSrc:"",navSrc:""}};e(d).images.push(r),tt(r)}},i.readAsDataURL(n)}}function Me(t){e(d).images=e(d).images.filter(a=>a!=t)}function ke(t,a){let l=e(d).images.findIndex(i=>i==t);if(l<0)return;let n=l+a;n>=e(d).images.length||e(d).images.splice(n,0,e(d).images.splice(l,1)[0])}function Ie(t){let a=document.getElementById(t);a&&a.click()}function ne(t){let a=t.target;return a?a.value:""}function We(t){e(d).content=t,e(d).contentParagraphs=t.split(`
`)}function Qe(){p(d,we,!0);let t=document.getElementById("inputTitle");t.value="";let a=document.getElementById("inputDate");a.value="";let l=document.getElementById("inputCollection");l.value="";let n=document.getElementById("contentTextArea");n.value=""}async function ue(t){const l=await(await fetch(t).then(n=>n.blob())).arrayBuffer();return new Uint8Array(l)}async function Se(t,a){let l=document.createElement("canvas"),n=l.getContext("2d");if(!n)return null;const i=a/(t.width/t.height);let s=Math.min(a/t.width,i/t.height),r=t.width*s,u=t.height*s;return l.width=r,l.height=u,n.drawImage(t,0,0,r,u),l.toDataURL("image/jpeg")}function Ve(t,a){e(d).collection=t,Xe()}async function ge(t,a=!1){let l=t.split("/"),n="root";for(let i=0;i<l.length;++i){let s=l[i],r=`'${n}' in parents and name = '${s}' and mimeType = 'application/vnd.google-apps.folder' and trashed = false`,u=await gapi.client.request({path:`/drive/v3/files?q=${encodeURI(r)}`,method:"GET"});if(!u)return null;let P=JSON.parse(u.body);if(!P.files||P.files.length==0){if(a){let q=JSON.stringify({name:s,parents:[n],mimeType:"application/vnd.google-apps.folder"});if(!await gapi.client.request({path:"/drive/v3/files",method:"POST",body:q,headers:{"content-type":"application/json","content-length":q.length}}))return null;--i;continue}return null}n=P.files[0].id}return n}async function Ye(){let t=`BlogData/Posts/${e(d).collection}`,a=`${e(d).collection}-01`,l=await ge(t);if(!l)return a;let n=`'${l}' in parents and mimeType != 'application/vnd.google-apps.folder'`,i=await gapi.client.request({path:"/drive/v3/files",params:{q:n},method:"GET"});if(!i)return a;let s=JSON.parse(i.body);if(!s.files||s.files.length==0)return a;s.files.sort((y,F)=>y.name<F.name?-1:y.name>F.name?1:0);let u=s.files[s.files.length-1].name.split("."),k=u[u.length-2].match(/(?:\d+)(?!.*\d)/),q=k?k[0]:null;return q?`${e(d).collection}-${String(Number(q)+1).padStart(2,"0")}`:a}async function Pe(t){let a=t.split("/"),l=a.slice(0,-1).join("/"),n=a[a.length-1],i=await ge(l);if(!i)return null;let s=`'${i}' in parents and name = '${n}'`,r=await gapi.client.request({path:"/drive/v3/files",params:{q:s},method:"GET"});if(!r)return null;let u=JSON.parse(r.body);return!u.files||u.files.length==0?null:u.files[0].id}async function Xe(){p(ve,!0);let t=await Ye();e(d).id=t,p(ve,!1)}async function Ze(){p(Q,!1),p(X,!0),p(S,"");let t=!0,a=JSON.parse(JSON.stringify(e(d)));a.images=new Array(e(d).images.length),a.contentParagraphs=void 0;for(let n=0;n<e(d).images.length&&!e(Q);++n){let i=e(d).images[n];p(S,e(S)+`Uploading images for '${i.name}'... `);let s=await et(i);if(t=!!s,p(S,e(S)+((t?"Success":"Failed")+"<br>")),!t||!s)break;a.images[n]=s}let l=`BlogData/Posts/${a.collection}/${a.id}.json`;if(t&&!e(Q)){let n=JSON.stringify(a),i=new TextEncoder;p(S,e(S)+`Uploading '${l}'... `);let s=await ie(l,i.encode(n));p(S,e(S)+(s?"Success":"Failed"))}e(Q)&&p(S,e(S)+"Cancelled"),p(X,!1)}async function et(t){let a={src:"",collageSrc:"",navSrc:""},l=t.name.split("."),n=l[0],i=await ue(t.data.src),s=`BlogData/Photos/${e(d).collection}/${t.name}`,r=await ie(s,i);if(r)a.src=`https://lh3.googleusercontent.com/d/${r}?authuser=0`;else return null;let u=n+"_w1000."+l[1];if(s=`BlogData/Photos/${e(d).collection}/${u}`,i=await ue(t.data.collageSrc),r=await ie(s,i),r)a.collageSrc=`https://lh3.googleusercontent.com/d/${r}?authuser=0`;else return null;if(u=n+"_w200."+l[1],s=`BlogData/Photos/${e(d).collection}/${u}`,i=await ue(t.data.navSrc),r=await ie(s,i),r)a.navSrc=`https://lh3.googleusercontent.com/d/${r}?authuser=0`;else return null;return a}async function tt(t){const a={collageSrc:1e3,navSrc:200};let l=new Image,n=new Promise((r,u)=>{l.onload=()=>{r(l)},l.onerror=()=>{u()}});l.src=t.data.src,await n;let i=await Se(l,a.collageSrc),s=e(d).images.find(r=>r.name==t.name);i&&s&&(s.data.collageSrc=i),i=await Se(l,a.navSrc),i&&s&&(s.data.navSrc=i)}async function ie(t,a){let l=await Pe(t);if(l)return l;let n=t.split("/"),i=n[n.length-1],s=n.slice(0,-1).join("/"),r=await ge(s,!0),P=JSON.stringify({name:i,parents:[r]}),k=await gapi.client.request({path:"/upload/drive/v3/files?uploadType=resumable",method:"POST",body:P,headers:{"content-type":"application/json","content-length":P.length,"x-upload-content-length":a.byteLength}});if(!k||!k.headers)return null;let y=JSON.parse(JSON.stringify(k.headers)).location;try{await fetch(y,{method:"PUT",body:a,headers:{"content-length":a.byteLength.toString()}})}catch{}return l=await Pe(t),l}async function De(){await gapi.client.init({apiKey:e(W)}),de=google.accounts.oauth2.initTokenClient({client_id:"953825518423-opf6ljfsqvslodfru7ugocm5ps5rgacp.apps.googleusercontent.com",scope:"https://www.googleapis.com/auth/drive.file",callback:async t=>{if(t.error!==void 0)throw alert(`Failed to authenticate: ${t}`),t;p(xe,!0)}}),p(ye,!0)}function at(t){let a=t.target;if(!a||!a.files||a.files.length==0)return;let l=a.files[0];const n=new FileReader;n.onload=function(){n.result&&(p(W,n.result.toString(),!0),localStorage.setItem("apiKey",e(W)),gapi.load("client",De))},n.readAsText(l)}function lt(){localStorage.removeItem("apiKey"),p(W,"")}function nt(){gapi.client.getToken()===null?de.requestAccessToken({prompt:"consent"}):de.requestAccessToken({prompt:""})}ft(async()=>{await Je("https://apis.google.com/js/api.js"),await Je("https://accounts.google.com/gsi/client");let t=localStorage.getItem("apiKey");t&&(p(W,t,!0),gapi.load("client",De))});var Ce=me(),it=U(Ce);{var st=t=>{var a=la(),l=U(a);{let c=J(()=>e(d).images.map(v=>v.data));Ot(l,{get imagesData(){return e(c)}})}var n=m(l,2),i=_(n),s=m(i,2);$e(s,21,()=>o.data.collections,Be,(c,v)=>{var x=jt(),D={};Y(()=>{D!==(D=e(v).id)&&(x.value=(x.__value=e(v).id)??"")}),h(c,x)}),g(s);var r=m(s,2);{var u=c=>{var v=Ft();h(c,v)},P=c=>{var v=Lt(),x=_(v,!0);g(v),Y(()=>qe(x,e(d).id)),h(c,v)};R(r,c=>{e(ve)?c(u):c(P,!1)})}var k=m(r,2),q=_(k);g(k);var y=m(k,2),F=_(y);g(y);var G=m(y,2),pe=_(G);pe.__click=[Rt,ce],g(G);var Z=m(G,2),_e=_(Z);_e.__click=[$t,Qe],g(Z),g(n);var Te=m(n,2);{var rt=c=>{var v=Kt(),x=_(v),D=m(x,2),E=_(D);Et(E);var z=m(E,2),ee=_(z);ee.__click=[Bt,Ze],g(z),g(D),g(v),Y(()=>{Ke(D,1,`${e(T)??""} ${e(j)??""}`,"svelte-5xvg81"),At(E,e(d).content)}),V("click",x,()=>p(O,!1),!0),V("change",E,H=>{p(ze,H.target==document.activeElement),We(ne(H))},!0),he(3,D,()=>be,()=>e($)),h(c,v)},ct=c=>{var v=Jt();v.__click=[Ut,O];var x=_(v,!0);g(v),Y(()=>{Ke(v,1,e(le),"svelte-5xvg81"),qe(x,e(Ge))}),he(3,v,()=>be,()=>e($)),h(c,v)};R(Te,c=>{e(O)?c(rt):c(ct,!1)})}var Ee=m(Te,2);{var dt=c=>{var v=Vt(),x=U(v),D=m(x,2),E=_(D),z=_(E);z.__click=[Gt,Ie];var ee=m(z,2);ee.__change=[zt,He],g(E);var H=m(E,4);$e(H,21,()=>e(d).images,Be,(B,A)=>{var se=Qt(),oe=U(se),te=_(oe),L=m(te,2),K=_(L),fe=_(K),gt=_(fe);gt.__click=[Ht,ke,A],g(fe);var Ae=m(fe,2),pt=_(Ae);pt.__click=[Mt,ke,A],g(Ae),g(K);var Oe=m(K,2),_t=_(Oe);_t.__click=[Wt,Me,A],g(Oe),g(L),g(oe),Tt(2),Y(()=>{Ue(te,"src",e(A).data.navSrc),Ue(te,"alt",e(A).name)}),h(B,se)}),g(H),g(D),V("click",x,()=>p(ce,!1),!0),he(3,D,()=>be,()=>b),h(c,v)};R(Ee,c=>{e(ce)&&c(dt)})}var vt=m(Ee,2);{var ut=c=>{var v=aa(),x=_(v),D=m(_(x),2);qt(D,()=>e(S));var E=m(D,2),z=_(E);{var ee=B=>{var A=me(),se=U(A);{var oe=L=>{var K=Yt();h(L,K)},te=L=>{var K=Zt();K.__click=[Xt,Q],h(L,K)};R(se,L=>{e(Q)?L(oe):L(te,!1)})}h(B,A)},H=B=>{var A=ta();A.__click=[ea,X,S],h(B,A)};R(z,B=>{e(X)?B(ee):B(H,!1)})}g(E),g(x),g(v),h(c,v)};R(vt,c=>{(e(X)||e(S))&&c(ut)})}V("change",i,c=>c.target!=document.activeElement?Ve(ne(c)):{},!0),V("change",q,c=>e(d).title=ne(c),!0),V("change",F,c=>e(d).date=ne(c),!0),h(t,a)},ot=t=>{var a=va(),l=_(a),n=_(l);{var i=r=>{var u=sa(),P=U(u);P.__click=[na,Ie];var k=m(P,2);k.__change=[ia,at],h(r,u)},s=r=>{var u=me(),P=U(u);{var k=y=>{var F=ca(),G=m(U(F),2),pe=_(G);pe.__click=[oa,nt],g(G);var Z=m(G,2),_e=_(Z);_e.__click=[ra,lt],g(Z),h(y,F)},q=y=>{var F=da();h(y,F)};R(P,y=>{e(ye)?y(k):y(q,!1)})}h(r,u)};R(n,r=>{e(W)?r(s,!1):r(i)})}g(l),g(a),h(t,a)};R(it,t=>{e(xe)?t(st):t(ot,!1)})}Re("innerWidth",t=>p(I,t,!0)),Re("innerHeight",t=>p(ae,t,!0)),h(f,Ce),Ct()}St(["click","change"]);export{ya as component,ba as universal};
